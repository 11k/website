// Message composition UI
$(function(){$("#compose.message-composition").each(function(){var e=$("#compose"),s=e.find(".modal-message"),t=e.find("#compose-form"),n=$("#alerts-container"),i=t.find("textarea#compose-message"),o=t.find("input#compose-recipients"),a=t.find(".modal-recipients .recipient-container"),c=t.find("button#modal-send-btn"),r=t.find("button#modal-close-btn"),l=t.find(".modal-user-groups"),d=!1,p=function(){t.find("button,input,textarea").attr("disabled","disabled")},u=function(){t.find("button,input,textarea").removeAttr("disabled")},f=function(){i.val(""),o.val(""),a.empty(),s.hide(),u()},m=function(){var t=i.val(),o=v();return 0==o.length?void s.show().html('<span class="text-danger">Recipients required</span>'):""==t.trim()?void s.show().html('<span class="text-danger">Message required</span>'):t.trim().length>500?void s.show().html('<span class="text-danger">Your message cannot be longer than 500 characters</span>'):(d=!0,p(),s.show().html('<i class="fa fa-cog fa-spin"></i> Sending message ...'),void $.ajax({type:"POST",url:"/profile/messages/send",data:{recipients:o,message:t},success:function(t){d=!1,1==t.success?(n.show().html('<div class="alert alert-info"><strong>Sent!</strong> Your message has been sent.</div>'),window.setTimeout(function(){n.hide()},3e3),e.modal("hide")):(s.show().html('<span class="text-danger">'+t.message+"</span>"),u())},error:function(e){d=!1,s.show().html('<span class="text-danger">'+e.status+": "+e.statusText+"</span>")}}))},h=function(e){for(var s=e.split(" "),t=[],n=0;n<s.length;++n)0==s[n].search(/^[A-Z0-9_]{3,20}$/i)&&t.push(s[n]);return t},g=function(e,s){var t=e.toLowerCase(),s=["recipient",s];a.find('.recipient[data-recipient="'+t+'"]').get(0)||a.append('<span class="'+s.join(" ")+'" data-recipient="'+t+'">                    <span class="recipient-name">'+e+'</span>                    <i class="glyphicon glyphicon-remove remove-recipient" title="Remove"></i>                  </span>')},v=function(){var e=[];return a.find(".recipient").each(function(){e.push($(this).data("recipient"))}),e};e.on("keydown",function(e){s.hide()}),e.on("shown.bs.modal",function(e){$(this).find("input#compose-recipients").focus()}),e.on("hidden.bs.modal",function(e){d||f()}),e.on("click",".remove-recipient",function(){$(this).closest(".recipient").remove()}),e.on("change","input#compose-recipients",function(e){var s=h($(this).val());o.val("");for(var t=0;t<s.length;++t)g(s[t])}),e.on("keypress","input#compose-recipients",function(e){var s=/[\;\:\,\']/i,t=e.which,n=32,i=13;if(t==n||t==i||s.test(String.fromCharCode(t))){var a=h($(this).val());o.val("");for(var c=0;c<a.length;++c)g(a[c]);e.preventDefault(),e.stopPropagation()}o.focus()}),r.on("click",function(s){e.modal("hide")}),c.on("click",function(e){m()}),i.on("keydown",function(e){e.ctrlKey&&13==e.keyCode&&(m(),e.preventDefault(),e.stopPropagation())}),l.on("click",".groups a",function(){g($(this).text(),"group")});var w=$("#compose");$(".message-list").on("click",".message-header,.message-summary",function(){$(this).closest(".message").toggleClass("message-active message-hidden")}),$(".message-reply").on("click","#reply-toggle",function(){w.unbind("shown.bs.modal").on("shown.bs.modal",function(){$(this).find("textarea").focus()}),w.find("#composeLabel").text("Reply ..."),w.find(".modal-recipients,.modal-settings,.modal-user-groups").hide(),o.val(""),a.empty(),g($(this).data("replyto"))}),$(".message-list").each(function(){var e=function(){$(this).closest(".message").addClass("message-active").removeClass("message-hidden")};$(this).on("click",".message-summary",e)})})}),$(function(){var e=$("table#inbox"),s=function(){$(this).find("i").attr("class","fa fa-dot-circle-o"),$(this).addClass("active")},t=function(){$(this).find("i").attr("class","fa fa-circle-o"),$(this).removeClass("active")},n=function(e){var n=$(this);n.closest("tr");e.preventDefault(),e.stopPropagation(),n.hasClass("active")?t.apply(n):s.apply(n)},i=function(e){var s=$(this),t=s.data("id");void 0!=t&&(e.preventDefault(),e.stopPropagation(),window.location.href="/profile/messages/"+t)},o=function(){$(this).addClass("pressed")},a=function(){$(this).removeClass("pressed")};e.each(function(e,s){$(s).on("click","tbody tr",i).on("click","tbody td.selector",n).on("mousedown","tbody tr",o).on("mouseup","tbody tr",a)}),$("#mark-all").on("click",function(e){e.preventDefault(),$.ajax({url:"/profile/messages/openall",success:function(){window.location.reload()}})})}),$(function(){var e=10,s=$(".message-list .message");if(s.length>e){var t=s.slice(0,-e);t.wrapAll('<div class="collapsed-group">                <div class="collapsed-group-label"><a href="#"><i class="fa fa-chevron-circle-down"></i> show '+t.length+" older messages</a></div>            </div>")}$(".message-list").on("click",".collapsed-group",function(e){$(this).addClass("active"),e.preventDefault()}),$(window).on("load",function(){$(".message-reply").each(function(){var e=$(this),s=e.offset().top+e.outerHeight(!0)-$(window).height();$("html,body").animate({scrollTop:s},5)})})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbIiQiLCJlYWNoIiwiJG1vZGFsIiwiJG1vZGFsbXNnIiwiZmluZCIsIiRmb3JtIiwiJHBhZ2VhbHJ0IiwiJG1lc3NhZ2UiLCIkcmVjaXBpZW50cyIsIiRyZWNpcGllbnRzY29udCIsIiRzdWJtaXRidG4iLCIkY2xzYnRuIiwiJHVzZXJncm91cHMiLCJzYXZlU3RhdGVPbkNsb3NlIiwiZGlzYWJsZU1lc3NhZ2VGb3JtIiwiYXR0ciIsImVuYWJsZU1lc3NhZ2VGb3JtIiwicmVtb3ZlQXR0ciIsInJlc2V0Rm9ybSIsInZhbCIsImVtcHR5IiwiaGlkZSIsInNlbmRNZXNzYWdlIiwibWVzc2FnZSIsInJlY2lwaWVudHMiLCJnZXRSZWNpcGllbnRMYWJlbHMiLCJsZW5ndGgiLCJzaG93IiwiaHRtbCIsInRyaW0iLCJhamF4IiwidHlwZSIsInVybCIsImRhdGEiLCJzdWNjZXNzIiwid2luZG93Iiwic2V0VGltZW91dCIsIm1vZGFsIiwiZXJyb3IiLCJlIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsInNwbGl0UmVjaXBpZW50U3RyaW5nIiwic3RyIiwic3BsaXRzIiwic3BsaXQiLCJuYW1lcyIsImkiLCJzZWFyY2giLCJwdXNoIiwiYWRkUmVjaXBpZW50TGFiZWwiLCJyZWNpcGllbnQiLCJzdHlsZSIsImlkIiwidG9Mb3dlckNhc2UiLCJnZXQiLCJhcHBlbmQiLCJqb2luIiwidGhpcyIsIm9uIiwiZm9jdXMiLCJjbG9zZXN0IiwicmVtb3ZlIiwia2V5Y2hlY2siLCJrZXkiLCJ3aGljaCIsIktFWUNPREVfU1BBQ0UiLCJLRVlDT0RFX0VOVEVSIiwidGVzdCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiY3RybEtleSIsImtleUNvZGUiLCJ0ZXh0IiwibXNnbW9kYWwiLCJ0b2dnbGVDbGFzcyIsInVuYmluZCIsInNob3dGdWxsTWVzc2FnZSIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJpbmJveHRhYmxlIiwiYWN0aXZhdGVTZWxlY3RvciIsImRlYWN0aXZhdGVTZWxlY3RvciIsInRvZ2dsZVJvd1NlbGVjdG9yIiwic2VsZiIsImhhc0NsYXNzIiwiYXBwbHkiLCJ0b2dnbGVSb3dDbGljayIsInVzZXJpZCIsInVuZGVmaW5lZCIsImxvY2F0aW9uIiwiaHJlZiIsInByZXNzZWRUYWJsZVJvdyIsInJlbGVhc2VkVGFibGVSb3ciLCJlbCIsInJlbG9hZCIsInNob3dtYXgiLCJtZXNzYWdlcyIsIm9sZG1lc3NhZ2VzIiwic2xpY2UiLCJ3cmFwQWxsIiwibGFzdGVsZW1lbnQiLCJvZmZzZXQiLCJ0b3AiLCJvdXRlckhlaWdodCIsImhlaWdodCIsImFuaW1hdGUiLCJzY3JvbGxUb3AiXSwibWFwcGluZ3MiOiI7QUFDQUEsRUFBRSxXQUVFQSxFQUFFLGdDQUFnQ0MsS0FBSyxXQUVuQyxHQUFJQyxHQUFTRixFQUFFLFlBQ1hHLEVBQVlELEVBQU9FLEtBQUssa0JBQ3hCQyxFQUFRSCxFQUFPRSxLQUFLLGlCQUNwQkUsRUFBWU4sRUFBRSxxQkFDZE8sRUFBV0YsRUFBTUQsS0FBSyw0QkFDdEJJLEVBQWNILEVBQU1ELEtBQUssNEJBQ3pCSyxFQUFrQkosRUFBTUQsS0FBSywwQ0FDN0JNLEVBQWFMLEVBQU1ELEtBQUsseUJBQ3hCTyxFQUFVTixFQUFNRCxLQUFLLDBCQUNyQlEsRUFBY1AsRUFBTUQsS0FBSyxzQkFDekJTLEdBQW1CLEVBRW5CQyxFQUFxQixXQUNyQlQsRUFBTUQsS0FBSyx5QkFBeUJXLEtBQUssV0FBWSxhQUdyREMsRUFBb0IsV0FDcEJYLEVBQU1ELEtBQUsseUJBQXlCYSxXQUFXLGFBRy9DQyxFQUFZLFdBQ1pYLEVBQVNZLElBQUksSUFDYlgsRUFBWVcsSUFBSSxJQUNoQlYsRUFBZ0JXLFFBQ2hCakIsRUFBVWtCLE9BQ1ZMLEtBR0FNLEVBQWMsV0FFZCxHQUFJQyxHQUFVaEIsRUFBU1ksTUFDbkJLLEVBQWFDLEdBRWpCLE9BQXdCLElBQXJCRCxFQUFXRSxXQUNWdkIs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RTBELE1BQ2hCOEMsRUFBU0QsRUFBWUMsU0FBU0MsSUFBTUYsRUFBWUcsYUFBWSxHQUFRMUcsRUFBRW1DLFFBQVF3RSxRQUNsRjNHLEdBQUUsYUFBYTRHLFNBQVNDLFVBQVVMLEdBQVEiLCJmaWxlIjoibWVzc2FnZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTWVzc2FnZSBjb21wb3NpdGlvbiBVSVxyXG4kKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgJCgnI2NvbXBvc2UubWVzc2FnZS1jb21wb3NpdGlvbicpLmVhY2goZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgdmFyICRtb2RhbCA9ICQoJyNjb21wb3NlJyksXHJcbiAgICAgICAgICAgICRtb2RhbG1zZyA9ICRtb2RhbC5maW5kKCcubW9kYWwtbWVzc2FnZScpLFxyXG4gICAgICAgICAgICAkZm9ybSA9ICRtb2RhbC5maW5kKCcjY29tcG9zZS1mb3JtJyksXHJcbiAgICAgICAgICAgICRwYWdlYWxydCA9ICQoJyNhbGVydHMtY29udGFpbmVyJyksXHJcbiAgICAgICAgICAgICRtZXNzYWdlID0gJGZvcm0uZmluZCgndGV4dGFyZWEjY29tcG9zZS1tZXNzYWdlJyksXHJcbiAgICAgICAgICAgICRyZWNpcGllbnRzID0gJGZvcm0uZmluZCgnaW5wdXQjY29tcG9zZS1yZWNpcGllbnRzJyksXHJcbiAgICAgICAgICAgICRyZWNpcGllbnRzY29udCA9ICRmb3JtLmZpbmQoJy5tb2RhbC1yZWNpcGllbnRzIC5yZWNpcGllbnQtY29udGFpbmVyJyksXHJcbiAgICAgICAgICAgICRzdWJtaXRidG4gPSAkZm9ybS5maW5kKCdidXR0b24jbW9kYWwtc2VuZC1idG4nKSxcclxuICAgICAgICAgICAgJGNsc2J0biA9ICRmb3JtLmZpbmQoJ2J1dHRvbiNtb2RhbC1jbG9zZS1idG4nKSxcclxuICAgICAgICAgICAgJHVzZXJncm91cHMgPSAkZm9ybS5maW5kKCcubW9kYWwtdXNlci1ncm91cHMnKSxcclxuICAgICAgICAgICAgc2F2ZVN0YXRlT25DbG9zZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgZGlzYWJsZU1lc3NhZ2VGb3JtID0gZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbixpbnB1dCx0ZXh0YXJlYScpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVuYWJsZU1lc3NhZ2VGb3JtID0gZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbixpbnB1dCx0ZXh0YXJlYScpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlc2V0Rm9ybSA9IGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICAkbWVzc2FnZS52YWwoJycpO1xyXG4gICAgICAgICAgICAkcmVjaXBpZW50cy52YWwoJycpO1xyXG4gICAgICAgICAgICAkcmVjaXBpZW50c2NvbnQuZW1wdHkoKTtcclxuICAgICAgICAgICAgJG1vZGFsbXNnLmhpZGUoKTtcclxuICAgICAgICAgICAgZW5hYmxlTWVzc2FnZUZvcm0oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbiAoKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJG1lc3NhZ2UudmFsKCksXHJcbiAgICAgICAgICAgICAgICByZWNpcGllbnRzID0gZ2V0UmVjaXBpZW50TGFiZWxzKCk7XHJcblxyXG4gICAgICAgICAgICBpZihyZWNpcGllbnRzLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgICAgICRtb2RhbG1zZy5zaG93KCkuaHRtbCgnPHNwYW4gY2xhc3M9XCJ0ZXh0LWRhbmdlclwiPlJlY2lwaWVudHMgcmVxdWlyZWQ8L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKG1lc3NhZ2UudHJpbSgpID09ICcnKXtcclxuICAgICAgICAgICAgICAgICRtb2RhbG1zZy5zaG93KCkuaHRtbCgnPHNwYW4gY2xhc3M9XCJ0ZXh0LWRhbmdlclwiPk1lc3NhZ2UgcmVxdWlyZWQ8L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKG1lc3NhZ2UudHJpbSgpLmxlbmd0aCA+IDUwMCl7XHJcbiAgICAgICAgICAgICAgICAkbW9kYWxtc2cuc2hvdygpLmh0bWwoJzxzcGFuIGNsYXNzPVwidGV4dC1kYW5nZXJcIj5Zb3VyIG1lc3NhZ2UgY2Fubm90IGJlIGxvbmdlciB0aGFuIDUwMCBjaGFyYWN0ZXJzPC9zcGFuPicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzYXZlU3RhdGVPbkNsb3NlID0gdHJ1ZTtcclxuICAgICAgICAgICAgZGlzYWJsZU1lc3NhZ2VGb3JtKCk7XHJcbiAgICAgICAgICAgICRtb2RhbG1zZy5zaG93KCkuaHRtbCgnPGkgY2xhc3M9XCJmYSBmYS1jb2cgZmEtc3BpblwiPjwvaT4gU2VuZGluZyBtZXNzYWdlIC4uLicpO1xyXG5cclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHVybDogJy9wcm9maWxlL21lc3NhZ2VzL3NlbmQnLFxyXG4gICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICdyZWNpcGllbnRzJyA6IHJlY2lwaWVudHMsXHJcbiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnIDogbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVTdGF0ZU9uQ2xvc2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpZihkYXRhLnN1Y2Nlc3MgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRwYWdlYWxydC5zaG93KCkuaHRtbCgnPGRpdiBjbGFzcz1cImFsZXJ0IGFsZXJ0LWluZm9cIj48c3Ryb25nPlNlbnQhPC9zdHJvbmc+IFlvdXIgbWVzc2FnZSBoYXMgYmVlbiBzZW50LjwvZGl2PicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhZ2VhbHJ0LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbW9kYWxtc2cuc2hvdygpLmh0bWwoJzxzcGFuIGNsYXNzPVwidGV4dC1kYW5nZXJcIj4nKyBkYXRhLm1lc3NhZ2UgKyc8L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU1lc3NhZ2VGb3JtKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlU3RhdGVPbkNsb3NlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsbXNnLnNob3coKS5odG1sKCc8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+JysgZS5zdGF0dXMgKyc6ICcrIGUuc3RhdHVzVGV4dCArJzwvc3Bhbj4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNwbGl0UmVjaXBpZW50U3RyaW5nID0gZnVuY3Rpb24gKHN0cil7XHJcbiAgICAgICAgICAgIHZhciBzcGxpdHMgPSBzdHIuc3BsaXQoJyAnKSxcclxuICAgICAgICAgICAgICAgIG5hbWVzID0gW107XHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPHNwbGl0cy5sZW5ndGg7KytpKXtcclxuICAgICAgICAgICAgICAgIGlmKHNwbGl0c1tpXS5zZWFyY2goL15bQS1aMC05X117MywyMH0kL2kpID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWVzLnB1c2goc3BsaXRzW2ldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbmFtZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZFJlY2lwaWVudExhYmVsID0gZnVuY3Rpb24ocmVjaXBpZW50LCBzdHlsZSl7XHJcbiAgICAgICAgICAgIHZhciBpZCA9IHJlY2lwaWVudC50b0xvd2VyQ2FzZSgpLFxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSBbJ3JlY2lwaWVudCcsIHN0eWxlXTtcclxuICAgICAgICAgICAgaWYoISRyZWNpcGllbnRzY29udC5maW5kKCcucmVjaXBpZW50W2RhdGEtcmVjaXBpZW50PVwiJysgaWQgKydcIl0nKS5nZXQoMCkpe1xyXG4gICAgICAgICAgICAgICAgJHJlY2lwaWVudHNjb250LmFwcGVuZChcclxuICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCInKyBzdHlsZS5qb2luKCcgJykgKydcIiBkYXRhLXJlY2lwaWVudD1cIicrIGlkICsnXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInJlY2lwaWVudC1uYW1lXCI+JysgcmVjaXBpZW50ICsnPC9zcGFuPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSByZW1vdmUtcmVjaXBpZW50XCIgdGl0bGU9XCJSZW1vdmVcIj48L2k+XFxcclxuICAgICAgICAgICAgICAgICAgPC9zcGFuPidcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UmVjaXBpZW50TGFiZWxzID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIG5hbWVzID0gW107XHJcbiAgICAgICAgICAgICRyZWNpcGllbnRzY29udC5maW5kKCcucmVjaXBpZW50JykuZWFjaChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgbmFtZXMucHVzaCggJCh0aGlzKS5kYXRhKCdyZWNpcGllbnQnKSApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5hbWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRtb2RhbC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKXtcclxuICAgICAgICAgICAgJG1vZGFsbXNnLmhpZGUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJG1vZGFsLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKXtcclxuICAgICAgICAgICAgJCh0aGlzKS5maW5kKCdpbnB1dCNjb21wb3NlLXJlY2lwaWVudHMnKS5mb2N1cygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkbW9kYWwub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKXtcclxuICAgICAgICAgICAgaWYoIXNhdmVTdGF0ZU9uQ2xvc2Upe1xyXG4gICAgICAgICAgICAgICAgcmVzZXRGb3JtKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJG1vZGFsLm9uKCdjbGljaycsICcucmVtb3ZlLXJlY2lwaWVudCcsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLnJlY2lwaWVudCcpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkbW9kYWwub24oJ2NoYW5nZScsICdpbnB1dCNjb21wb3NlLXJlY2lwaWVudHMnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgdmFyIHJlY2lwaWVudHMgPSBzcGxpdFJlY2lwaWVudFN0cmluZyggJCh0aGlzKS52YWwoKSApO1xyXG4gICAgICAgICAgICAkcmVjaXBpZW50cy52YWwoJycpO1xyXG4gICAgICAgICAgICBmb3IodmFyIGk9MDsgaTxyZWNpcGllbnRzLmxlbmd0aDsgKytpKXtcclxuICAgICAgICAgICAgICAgIGFkZFJlY2lwaWVudExhYmVsKCByZWNpcGllbnRzW2ldICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJG1vZGFsLm9uKCdrZXlwcmVzcycsICdpbnB1dCNjb21wb3NlLXJlY2lwaWVudHMnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgdmFyIGtleWNoZWNrID0gL1tcXDtcXDpcXCxcXCddL2ksXHJcbiAgICAgICAgICAgICAgICBrZXkgPSBlLndoaWNoLFxyXG4gICAgICAgICAgICAgICAgS0VZQ09ERV9TUEFDRSA9IDMyLFxyXG4gICAgICAgICAgICAgICAgS0VZQ09ERV9FTlRFUiA9IDEzO1xyXG4gICAgICAgICAgICBpZihrZXkgPT0gS0VZQ09ERV9TUEFDRSB8fCBrZXkgPT0gS0VZQ09ERV9FTlRFUiB8fCBrZXljaGVjay50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5KSkpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlY2lwaWVudHMgPSBzcGxpdFJlY2lwaWVudFN0cmluZyggJCh0aGlzKS52YWwoKSApO1xyXG4gICAgICAgICAgICAgICAgJHJlY2lwaWVudHMudmFsKCcnKTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPHJlY2lwaWVudHMubGVuZ3RoOyArK2kpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZFJlY2lwaWVudExhYmVsKCByZWNpcGllbnRzW2ldICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRyZWNpcGllbnRzLmZvY3VzKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRjbHNidG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpe1xyXG4gICAgICAgICAgICAkbW9kYWwubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHN1Ym1pdGJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoZSl7XHJcbiAgICAgICAgICAgIHNlbmRNZXNzYWdlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRtZXNzYWdlLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUuY3RybEtleSAmJiBlLmtleUNvZGUgPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICR1c2VyZ3JvdXBzLm9uKCdjbGljaycsICcuZ3JvdXBzIGEnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBhZGRSZWNpcGllbnRMYWJlbCggJCh0aGlzKS50ZXh0KCksICdncm91cCcgKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIG1zZ21vZGFsID0gJCgnI2NvbXBvc2UnKTtcclxuXHJcbiAgICAgICAgJCgnLm1lc3NhZ2UtbGlzdCcpLm9uKCdjbGljaycsICcubWVzc2FnZS1oZWFkZXIsLm1lc3NhZ2Utc3VtbWFyeScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLm1lc3NhZ2UnKS50b2dnbGVDbGFzcygnbWVzc2FnZS1hY3RpdmUgbWVzc2FnZS1oaWRkZW4nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLm1lc3NhZ2UtcmVwbHknKS5vbignY2xpY2snLCAnI3JlcGx5LXRvZ2dsZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIG1zZ21vZGFsLnVuYmluZCgnc2hvd24uYnMubW9kYWwnKS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCd0ZXh0YXJlYScpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtc2dtb2RhbC5maW5kKCcjY29tcG9zZUxhYmVsJykudGV4dCgnUmVwbHkgLi4uJyk7XHJcbiAgICAgICAgICAgIG1zZ21vZGFsLmZpbmQoJy5tb2RhbC1yZWNpcGllbnRzLC5tb2RhbC1zZXR0aW5ncywubW9kYWwtdXNlci1ncm91cHMnKS5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICAkcmVjaXBpZW50cy52YWwoJycpO1xyXG4gICAgICAgICAgICAkcmVjaXBpZW50c2NvbnQuZW1wdHkoKTtcclxuICAgICAgICAgICAgYWRkUmVjaXBpZW50TGFiZWwoICQodGhpcykuZGF0YSgncmVwbHl0bycpICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoJy5tZXNzYWdlLWxpc3QnKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBzaG93RnVsbE1lc3NhZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcubWVzc2FnZScpLmFkZENsYXNzKCdtZXNzYWdlLWFjdGl2ZScpLnJlbW92ZUNsYXNzKCdtZXNzYWdlLWhpZGRlbicpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkKHRoaXMpLm9uKCdjbGljaycsICcubWVzc2FnZS1zdW1tYXJ5Jywgc2hvd0Z1bGxNZXNzYWdlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgIH0pO1xyXG5cclxufSk7XHJcblxyXG4vLyBJTkJPWFxyXG4kKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIGluYm94dGFibGUgPSAkKCd0YWJsZSNpbmJveCcpO1xyXG5cclxuICAgIHZhciBhY3RpdmF0ZVNlbGVjdG9yID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkKHRoaXMpLmZpbmQoJ2knKS5hdHRyKCdjbGFzcycsICdmYSBmYS1kb3QtY2lyY2xlLW8nKTtcclxuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGRlYWN0aXZhdGVTZWxlY3RvciA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJCh0aGlzKS5maW5kKCdpJykuYXR0cignY2xhc3MnLCAnZmEgZmEtY2lyY2xlLW8nKTtcclxuICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHRvZ2dsZVJvd1NlbGVjdG9yID0gZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgdmFyIHNlbGYgPSAkKHRoaXMpLFxyXG4gICAgICAgICAgICB0ciA9IHNlbGYuY2xvc2VzdCgndHInKTtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZihzZWxmLmhhc0NsYXNzKCdhY3RpdmUnKSl7XHJcbiAgICAgICAgICAgIGRlYWN0aXZhdGVTZWxlY3Rvci5hcHBseShzZWxmKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgYWN0aXZhdGVTZWxlY3Rvci5hcHBseShzZWxmKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciB0b2dnbGVSb3dDbGljayA9IGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIHZhciBzZWxmID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgdXNlcmlkID0gc2VsZi5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGlmKHVzZXJpZCAhPSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9wcm9maWxlL21lc3NhZ2VzLycrIHVzZXJpZDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBwcmVzc2VkVGFibGVSb3cgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ3ByZXNzZWQnKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHJlbGVhc2VkVGFibGVSb3cgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3ByZXNzZWQnKTtcclxuICAgIH07XHJcblxyXG4gICAgaW5ib3h0YWJsZS5lYWNoKGZ1bmN0aW9uKGksIGVsKXtcclxuICAgICAgICAkKGVsKVxyXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgJ3Rib2R5IHRyJywgdG9nZ2xlUm93Q2xpY2spXHJcbiAgICAgICAgICAgIC5vbignY2xpY2snLCAndGJvZHkgdGQuc2VsZWN0b3InLCB0b2dnbGVSb3dTZWxlY3RvcilcclxuICAgICAgICAgICAgLm9uKCdtb3VzZWRvd24nLCAndGJvZHkgdHInLCBwcmVzc2VkVGFibGVSb3cpXHJcbiAgICAgICAgICAgIC5vbignbW91c2V1cCcsICd0Ym9keSB0cicsIHJlbGVhc2VkVGFibGVSb3cpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnI21hcmstYWxsJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy9wcm9maWxlL21lc3NhZ2VzL29wZW5hbGwnLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbn0pO1xyXG5cclxuLy8gbWVzc2FnZVxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgc2hvd21heCA9IDEwLCBcclxuICAgICAgICBtZXNzYWdlcyA9ICQoJy5tZXNzYWdlLWxpc3QgLm1lc3NhZ2UnKTtcclxuICAgIGlmKG1lc3NhZ2VzLmxlbmd0aCA+IHNob3dtYXgpe1xyXG4gICAgICAgIHZhciBvbGRtZXNzYWdlcyA9IG1lc3NhZ2VzLnNsaWNlKDAsIC1zaG93bWF4KTtcclxuICAgICAgICBvbGRtZXNzYWdlcy53cmFwQWxsKFxyXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNvbGxhcHNlZC1ncm91cFwiPlxcXHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sbGFwc2VkLWdyb3VwLWxhYmVsXCI+PGEgaHJlZj1cIiNcIj48aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tY2lyY2xlLWRvd25cIj48L2k+IHNob3cgJysgb2xkbWVzc2FnZXMubGVuZ3RoICsnIG9sZGVyIG1lc3NhZ2VzPC9hPjwvZGl2PlxcXHJcbiAgICAgICAgICAgIDwvZGl2PidcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgJCgnLm1lc3NhZ2UtbGlzdCcpLm9uKCdjbGljaycsICcuY29sbGFwc2VkLWdyb3VwJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICQoJy5tZXNzYWdlLXJlcGx5JykuZWFjaChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgbGFzdGVsZW1lbnQgPSAkKHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gbGFzdGVsZW1lbnQub2Zmc2V0KCkudG9wICsgbGFzdGVsZW1lbnQub3V0ZXJIZWlnaHQodHJ1ZSkgLSAkKHdpbmRvdykuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDpvZmZzZXR9LDUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyJdfQ==
