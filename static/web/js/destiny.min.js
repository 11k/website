function htmlEncode(value){return String(value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}$.fn.loadImages=function(options){return options=$.extend({},{attr:"src"},options),this.find("img[data-"+options.attr+"]").each(function(){var img=$(this),url=img.data(options.attr);if(""!=url&&null!=url){var nimg=img.clone();nimg.one("load",function(){img.replaceWith(nimg)}),nimg.removeAttr(options.attr).removeAttr("data-"+options.attr).attr("src",url)}})},$.fn.sortElements=function(){var sort=[].sort;return function(comparator,getSortable){getSortable=getSortable||function(){return this};var placements=this.map(function(){var sortElement=getSortable.call(this),parentNode=sortElement.parentNode,nextSibling=parentNode.insertBefore(document.createTextNode(""),sortElement.nextSibling);return function(){if(parentNode===this)throw new Error("You can't sort elements if any one is a descendant of another.");parentNode.insertBefore(this,nextSibling),parentNode.removeChild(nextSibling)}});return sort.call(this,comparator).each(function(i){placements[i].call(getSortable.call(this))})}}(),String.prototype.trim||(String.prototype.trim=function(){return $.trim(this)}),String.prototype.replaceAll||(String.prototype.replaceAll=function(find,replace){var str=this;return str.replace(new RegExp(find,"g"),replace)}),String.prototype.format||(String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})}),destiny={cdn:"",token:"",baseUrl:"/",timeout:15e3,fn:{}},destiny.init=function(args){$.extend(destiny,args)},$(function(){var body=$("body"),popupDefaults={height:500,width:420,scrollbars:0,toolbar:0,location:0,status:"no",menubar:0,resizable:0,dependent:0};window.getOptionsString=function(options){options=options?$.extend({},popupDefaults,options):popupDefaults;var str="";for(var i in options)options.hasOwnProperty(i)&&(str+=i+"="+options[i]+",");return str},$("body#bigscreen").each(function(){var chatpanel=$("#chat-panel"),streampanel=$("#stream-panel"),chatframe=$("iframe#chat-frame"),overlay=$('<div class="overlay" />');chatframe.on("load",function(){var chatwindow=this.contentWindow;chatwindow&&$("#chat-panel-tools").each(function(){$(this).on("click","#popout",function(){return window.open("/embed/chat","_blank",window.getOptionsString()),$("body").addClass("nochat"),chatpanel.remove(),streampanel.removeAttr("style"),!1}),$(this).on("click","#refresh",function(){return chatwindow.location.reload(),!1}),$(this).on("click","#close",function(){return $("body").addClass("nochat"),chatpanel.remove(),streampanel.removeAttr("style"),!1})})}),$("#chat-panel-resize-bar").each(function(){var resizebar=$(this),minwidth=320,disableWidth=768;resizebar.css("left",0);var resizeFrames=function(nwidth){minwidth>nwidth&&(nwidth=minwidth),streampanel.css("width","-moz-calc(100% - "+nwidth+"px)"),streampanel.css("width","-webkit-calc(100% - "+nwidth+"px)"),streampanel.css("width","-o-calc(100% - "+nwidth+"px)"),streampanel.css("width","calc(100% - "+nwidth+"px)"),chatpanel.css("width",nwidth),resizebar.css("left",0),localStorage["bigscreen.chat.width"]=nwidth};resizebar.on("mousedown.chatresize",function(e){e.preventDefault(),resizebar.addClass("active"),overlay.appendTo("body");var offsetX=e.clientX,sx=resizebar.position().left;$(document).on("mouseup.chatresize",function(e){e.preventDefault(),resizebar.removeClass("active"),overlay.remove(),resizebar.css("left",sx+(e.clientX-offsetX)),$(document).unbind("mousemove.chatresize"),$(document).unbind("mouseup.chatresize"),resizeFrames(chatpanel.offset().left+chatpanel.outerWidth()-resizebar.offset().left)}),$(document).on("mousemove.chatresize",function(e){e.preventDefault(),resizebar.css("left",sx+(e.clientX-offsetX))})}),$(window).on("resize.chatresize",function(){$(window).width()<=disableWidth&&(streampanel.removeAttr("style"),chatpanel.removeAttr("style"))});var width=parseInt(localStorage["bigscreen.chat.width"]);width>minwidth&&$(window).width()>disableWidth&&resizeFrames(width)})}),$(".collapse").not("#collapsemenu").collapse(),$(".collapsible").each(function(){var $c=$(this),$t=$c.find("> h3"),$v=$c.find("> content");$t.on("click",function(){$c.hasClass("active")?($t.find(">.expander").removeClass("fa-chevron-down").addClass("fa-chevron-right"),$v.hide()):($t.find(">.expander").removeClass("fa-chevron-right").addClass("fa-chevron-down"),$v.show()),$c.toggleClass("active")})}),$(".btn-show-all").on("click",function(){$(".collapsible").each(function(){var $c=$(this),$t=$c.find("> h3"),$v=$c.find("> content");$t.find(">.expander").removeClass("fa-chevron-right").addClass("fa-chevron-down"),$v.show(),$c.addClass("active")})}),""!==location.hash&&$('a[href="'+location.hash+'"]').tab("show"),$('.navbar a[rel="'+body.attr("id")+'"]').closest("li").addClass("active"),$('.navbar a[rel="'+body.attr("class")+'"]').closest("li").addClass("active"),body.on("click","a.popup",function(e){var a=$(this);return a.data("popup",window.open(a.attr("href"),"_blank",window.getOptionsString(a.data("options")))),e.preventDefault(),!0}),$(this).loadImages(),$(this).find('[data-toggle="tooltip"]').tooltip()}),function(){var applyMomentToElement=function(e){var ui=$(e),datetime=ui.data("datetime")||ui.attr("datetime")||ui.text(),format=ui.data("format")||"MMMM Do, h:mm:ss a";ui.data("moment-fromnow")?(ui.addClass("moment-update"),ui.html(moment(datetime).fromNow())):ui.data("moment-calendar")?(ui.addClass("moment-update"),ui.html(moment(datetime).calendar())):ui.html(moment(datetime).format(format)),ui.data("datetime",datetime).addClass("moment-set")};window.setInterval(function(){$("time.moment-update").each(function(){applyMomentToElement(this)})},3e4),$('time[data-moment="true"]:not(.moment-set)').each(function(){applyMomentToElement(this)})}(),function(){window.setInterval(function(){$.ajax({url:"/ping",method:"get"})},6e5)}(),function(){var usrSearch=$("#userSearchModal"),usrInput=usrSearch.find("input#userSearchInput"),usrSelectBtn=usrSearch.find("button#userSearchSelect"),usrSearchFrm=usrSearch.find("form#userSearchForm"),giftMsgInput=usrSearch.find("textarea#giftmessage"),hasErrors=!1,giftUsername="",checkUser=function(username,success){$.ajax({url:"/gift/check",data:{s:username},type:"GET",success:function(data){success.call(this,data)},error:function(){showLookupError("Error looking up user. Try again")}})},showLookupError=function(message){hasErrors=!0,usrSelectBtn.button("reset").attr("disabled",!0),usrSearch.find("label.error").text(message).removeClass("hidden")},cancelUserSelect=function(){usrSearch.modal("hide"),usrInput.val(""),giftMsgInput.val(""),$("#subscriptionGiftUsername").text(""),$("#giftSubscriptionConfirm").addClass("hidden"),$("#giftSubscriptionSelect").removeClass("hidden"),$('input[name="gift"]').val(""),$('input[name="gift-message"]').val("")},selectUser=function(username){usrSelectBtn.button("loading"),checkUser(username,function(response){response.valid&&response.cangift?(giftUsername=username,""==giftMsgInput.val()?giftMsgInput.focus():usrSearchFrm.submit(),usrSelectBtn.button("reset").attr("disabled",!1),hasErrors=!1):response.valid?response.cangift||showLookupError("This user is not eligible for a gift."):showLookupError("This user was not found. Try again.")})};usrInput.on("keydown change",function(){usrSelectBtn.attr("disabled",""==$(this).val()),usrSearch.find("label.error").addClass("hidden")}),usrSearchFrm.on("submit",function(){return usrSearch.find("label.error").addClass("hidden"),giftUsername!=usrInput.val()?selectUser(usrInput.val()):($("#subscriptionGiftUsername").text(usrInput.val()),$("#giftSubscriptionConfirm").removeClass("hidden"),$("#giftSubscriptionSelect").addClass("hidden"),$('input[name="gift"]').val(usrInput.val()),$('input[name="gift-message"]').val(giftMsgInput.val()),usrSearch.modal("hide")),!1}),usrSearch.on("shown.bs.modal",function(e){usrInput.focus()}),usrSearch.on("hidden.bs.modal",function(e){hasErrors&&(hasErrors=!1,giftUsername="",usrInput.val(""),giftMsgInput.val(""),usrSearch.find("label.error").addClass("hidden"))}),$("#cancelGiftSubscription").on("click",function(){return usrSearch.find("label.error").addClass("hidden"),cancelUserSelect(),!1})}(),$(function(){$("form#addressSaveForm").validate({rules:{fullName:{required:!0},line1:{required:!0},line2:{required:!1},city:{required:!0},region:{required:!0},zip:{required:!0},country:{required:!0}},highlight:function(element){$(element).closest(".form-group").addClass("error")},unhighlight:function(element){$(element).closest(".form-group").removeClass("error")}})}),$(function(){$("#stream-status").each(function(){var el=$(this),a=el.find("#stream-status-preview > a"),end=el.find("#stream-status-end"),start=el.find("#stream-status-start"),host=el.find("#stream-status-host"),status={live:!1,game:null,preview:"",animated_preview:"",status_text:"",started_at:null,ended_at:"",duration:0,viewers:0,host:{},etag:null},updateStatus=function(status){var state=status.host&&void 0!==status.host.target_id?"hosting":status.live?"online":"offline";el.removeClass("online offline hosting").addClass(state),end.text(moment(status.ended_at).fromNow()),start.text(moment(status.started_at).fromNow()),a.data("animated",status.animated_preview).css("background-image",status.preview),"hosting"==state&&(host.text(status.host.display_name),host.attr("href",status.host.url))};setInterval(function(){$.ajax({url:"/stream.json",ifModified:!0,type:"GET"}).success(function(data,textStatus,xhr){xhr.getResponseHeader("ETag")!==status.etag&&(status=$.extend(status,{etag:xhr.getResponseHeader("ETag")},data),updateStatus(status))})},6e4),a.src=a.css("background-image"),a.animated="url("+a.data("animated")+")",a.on("mouseover",function(){a.css("background-image",a.animated)}).on("mouseout",function(){a.css("background-image",a.src)})})});
//# sourceMappingURL=destiny.min.js.map