(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{129:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(10),i=[new s.d,new s.f,new s.b],r={};!function(){var e,t,n,a,s,c,d,l,u,p,m,f,h,g,v,b=o()("form#inbox-tools-form"),w=o()("#compose.message-composition");w.length>0&&(e=w.find(".modal-message"),t=w.find("#compose-form"),n=o()("#alerts-container"),a=t.find("textarea#compose-message"),s=t.find("input#compose-recipients"),c=t.find(".modal-recipients .recipient-container"),d=t.find("button#modal-send-btn"),l=t.find("button#modal-close-btn"),u=t.find(".modal-user-groups"),p=!1,m=function(){t.find("button,input,textarea").removeAttr("disabled")},f=function(){var s=a.val(),i=v();0!==i.length?""!==s.trim()?s.trim().length>500?e.show().html('<span class="text-danger">Your message cannot be longer than 500 characters</span>'):(t.find("button,input,textarea").attr("disabled","disabled"),e.show().html('<i class="fas fa-cog fa-spin"></i> Sending message ...'),p=!0,o.a.ajax({type:"post",url:"/profile/messages/send",data:{recipients:i,message:s}}).always(function(){return p=!1}).fail(function(t){return e.show().html('<span class="text-danger">'.concat(t.status,": ").concat(t.statusText,"</span>"))}).done(function(t){!0===t.success?(n.show().html('<div class="alert alert-info"><strong>Sent!</strong> Your message has been sent.</div>'),window.setTimeout(function(){return n.hide()},3e3),w.modal("hide")):(e.show().html('<span class="text-danger">'.concat(t.message,"</span>")),m())})):e.show().html('<span class="text-danger">Message required</span>'):e.show().html('<span class="text-danger">Recipients required</span>')},h=function(e){return e.split(" ").filter(function(e){return 0===e.search(/^[A-Z0-9_]{3,20}$/i)})},g=function(e,t){var n=e.toLowerCase();t=["recipient",t],c.find('.recipient[data-recipient="'+n+'"]').get(0)||c.append(""+'<span class="'.concat(t.join(" "),'" data-recipient="').concat(n,'">')+'<span class="recipient-name">'.concat(e,"</span>")+'<i class="glyphicon glyphicon-remove remove-recipient" title="Remove"></i></span>')},v=function(){return c.find(".recipient").get().map(function(e){return o()(e).data("recipient")})},w.on("keydown",function(){return e.hide()}),w.on("shown.bs.modal",function(e){return o()(e.currentTarget).find("input#compose-recipients").focus()}),w.on("hidden.bs.modal",function(){p||(a.val(""),s.val(""),c.empty(),e.hide(),m())}),w.on("click",".remove-recipient",function(e){return o()(e.currentTarget).closest(".recipient").remove()}),w.on("change","input#compose-recipients",function(){h(o()(this).val()).forEach(g),s.val("")}),w.on("keypress","input#compose-recipients",function(e){var t=e.which;(32===t||13===t||/[;:,']/i.test(String.fromCharCode(t)))&&(h(o()(this).val()).forEach(g),s.val(""),e.preventDefault(),e.stopPropagation()),s.focus()}),l.on("click",function(){return w.modal("hide")}),d.on("click",f),a.on("keydown",function(e){e.ctrlKey&&13===e.keyCode&&(f(),e.preventDefault(),e.stopPropagation())}),u.on("click",".groups a",function(e){return g(o()(e.currentTarget).text(),"group")}),o()("#inbox-message-reply").on("click",function(e){w.unbind("shown.bs.modal").on("shown.bs.modal",function(e){return o()(e.currentTarget).find("textarea").focus()}),w.find("#composeLabel").text("Reply ..."),w.find(".modal-recipients,.modal-settings,.modal-user-groups").hide(),s.val(""),c.empty(),g(o()(e.currentTarget).data("replyto"))}));var y=function(e,t,n){!t||t.length<n?e.text("The End").prop("disabled",!0).attr("class","btn btn btn-dark").show():e.text("Show more").prop("disabled",!1).attr("class","btn btn-primary").show()},x=o()("#inbox-list");x.length>0&&function(){var e=o()("#inbox-tools"),t=e.find("#inbox-toggle-select"),n=e.find("#inbox-read-selected"),a=e.find("#inbox-delete-selected"),s=o()("#inbox-list-more"),c=o()("#inbox-loading"),d=o()("#inbox-empty"),l=o()("#inbox-modal-delete"),u=0,p=function(){var e=0===m().length;n.prop("disabled",e),a.prop("disabled",e)},m=function(){return x.find("td.selector.active").toArray()},f=function(){o()(this).addClass("active").find("i").attr("class","far fa-dot-circle"),p()},h=function(){o()(this).removeClass("active").find("i").attr("class","far fa-circle"),p()},g=function(e){var t=o()(this);e.preventDefault(),e.stopPropagation(),t.hasClass("active")?h.apply(t):f.apply(t)},v=function(e){var t=o()(this).data("id");void 0!==t&&(e.preventDefault(),e.stopPropagation(),window.location.href="/profile/messages/"+encodeURIComponent(t))},w=function(){o()(this).addClass("pressed")},k=function(){o()(this).removeClass("pressed")};x.each(function(e,t){o()(t).on("click","tbody tr",v).on("click","tbody td.selector",g).on("mousedown","tbody tr",w).on("mouseup","tbody tr",k)}),t.on("click touch",function(e){return x.find(".selector").each(function(){var e=o()(this);e.hasClass("active")?h.apply(e):f.apply(e)}),!1}),n.on("click touch",function(){var e=m().map(function(e){return o()(e).closest("tr").data("id")});return b.attr("action","/profile/messages/read").append(e.map(function(e){return'<input type="hidden" name="selected[]" value="'.concat(e,'" />')})).submit(),!1}),a.on("click touch",function(){var e=m().map(function(e){return o()(e).closest("tr").data("id")}),t=l.find("button");l.find(".modal-body").html("<div>Are you sure you want to delete ".concat(e.length," conversation(s)?</div>")+"<div>This cannot be undone.</div>"),l.on("click touch","#deleteConversation",function(){t.prop("disabled",!0),b.attr("action","/profile/messages/delete").append(e.map(function(e){return'<input type="hidden" name="selected[]" value="'.concat(e,'" />')})).submit()}),l.modal("show")});var C=function(e){var t=e.message.trim();return i.forEach(function(e){return t=e.format(r,t)}),'<tr data-id="'.concat(e.userid,'" data-username="').concat(e.user,'" class="').concat(e.unread<=0?"read":"unread",'">')+'<td class="selector"><i class="far fa-circle"></i></td><td class="from">'+'<a href="/profile/messages/'.concat(e.userid,'">').concat(e.user,"</a> ")+'<span class="count">('.concat(e.unread>0?e.unread:parseInt(e.read)+parseInt(e.unread),")</span>")+"</td>"+'<td class="message-txt"><span>'.concat(t,"</span></td>")+'<td class="timestamp"><time data-moment>'.concat(e.timestamp,"</time></td>")+"</tr>"},T=function(e){u+=25,x.find("table#inbox-message-grid tbody").append((e||[]).map(C).join("")),y(s,e,25),d.toggle(25===u&&0===e.length),c.fadeOut(),window.applyMomentToElements()},I=function(){return c.fadeIn(),o.a.ajax({url:"/api/messages/inbox",data:{s:u}}).always(T)};s.on("click",I),I()}();var k=o()("#message-list");if(k.length>0){var C=k.data("userid"),T=k.data("username"),I=o()("#inbox-loading"),j=o()("#inbox-list-more"),E=o()("#inbox-delete-selected"),A=o()("#inbox-empty"),R=o()("#inbox-modal-delete"),D=0,P=function(e){var t=e.message.trim();i.forEach(function(e){return t=e.format(r,t)});var n=parseInt(C)!==parseInt(e.userid),a=[];return a.push("message-active"),a.push("message-"+(n?"me":"notme")),a.push(1===e.isread?"message-read":"message-unread"),'<tr data-id="'.concat(e.id,'" data-username="').concat(e.from,'" class="').concat(a.join(" "),'">')+'<td class="message"><div class="message-header"><div class="from">'+'<i title="'.concat(e.isread?"Opened":"Unopened",'" class="fa fa-fw fa-dgg-').concat(e.isread?"read":"unread",'"></i>')+'<div class="username">'.concat(e.from,"</div>")+'<time class="timestamp" data-moment data-moment-fromnow="true">'.concat(e.timestamp,"</time>")+"</div>"+'<time class="timestamp" data-moment>'.concat(e.timestamp,"</time>")+"</div>"+'<div class="message-txt">'.concat(t,"</div>")+"</td></tr>"},S=function(e){D+=25,k.find("table#inbox-message-grid tbody").append((e.length?e:[]).map(P).join("")),y(j,e,25),A.toggle(25===D&&0===e.length),I.fadeOut(),window.applyMomentToElements()},L=function(){return I.fadeIn(),o.a.ajax({url:"/api/messages/usr/".concat(encodeURIComponent(T.toLowerCase()),"/inbox"),data:{s:D}}).always(S)};j.on("click",L),L(),E.on("click touch",function(){var e=[k.data("userid")];R.find(".modal-body").html("<div>Are you sure you want to delete this entire conversation?</div><div>This cannot be undone.</div>"),R.on("click touch","#deleteConversation",function(){b.attr("action","/profile/messages/delete").append(e.map(function(e){return'<input type="hidden" name="selected[]" value="'.concat(e,'" />')})).submit()}),R.modal("show")}),o()("#inbox-scroll-bottom").on("click",function(){return window.scrollTo(0,document.body.scrollHeight),!1}),o()("#inbox-scroll-top").on("click",function(){return window.scrollTo(0,0),!1})}}()}},[[129,1,0,2]]]);