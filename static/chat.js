webpackJsonp([2],{118:function(e,t){function n(){return(new Date).getTime()}e.exports=Date.now||n},135:function(e,t){e.exports=["NORTHWESTERNMUTUAL","TRAVELERSINSURANCE","AMERICANEXPRESS","KERRYPROPERTIES","SANDVIKCOROMANT","AFAMILYCOMPANY","AMERICANFAMILY","BANANAREPUBLIC","CANCERRESEARCH","COOKINGCHANNEL","KERRYLOGISTICS","WEATHERCHANNEL","INTERNATIONAL","LIFEINSURANCE","SPREADBETTING","TRAVELCHANNEL","WOLTERSKLUWER","CONSTRUCTION","LPLFINANCIAL","PAMPEREDCHEF","SCHOLARSHIPS","VERSICHERUNG","ACCOUNTANTS","BARCLAYCARD","BLACKFRIDAY","BLOCKBUSTER","BRIDGESTONE","CALVINKLEIN","CONTRACTORS","CREDITUNION","ENGINEERING","ENTERPRISES","FOODNETWORK","INVESTMENTS","KERRYHOTELS","LAMBORGHINI","MOTORCYCLES","OLAYANGROUP","PHOTOGRAPHY","PLAYSTATION","PRODUCTIONS","PROGRESSIVE","REDUMBRELLA","RIGHTATHOME","WILLIAMHILL","ACCOUNTANT","APARTMENTS","ASSOCIATES","BASKETBALL","BNPPARIBAS","BOEHRINGER","CAPITALONE","CONSULTING","CREDITCARD","CUISINELLA","EUROVISION","EXTRASPACE","FOUNDATION","HEALTHCARE","IMMOBILIEN","INDUSTRIES","MANAGEMENT","MITSUBISHI","NATIONWIDE","NEWHOLLAND","NEXTDIRECT","ONYOURSIDE","PROPERTIES","PROTECTION","PRUDENTIAL","REALESTATE","REPUBLICAN","RESTAURANT","SCHAEFFLER","SWIFTCOVER","TATAMOTORS","TECHNOLOGY","TELEFONICA","UNIVERSITY","VISTAPRINT","VLAANDEREN","VOLKSWAGEN","ACCENTURE","ALFAROMEO","ALLFINANZ","AMSTERDAM","ANALYTICS","AQUARELLE","BARCELONA","BLOOMBERG","CHRISTMAS","COMMUNITY","DIRECTORY","EDUCATION","EQUIPMENT","FAIRWINDS","FINANCIAL","FIRESTONE","FRESENIUS","FRONTDOOR","FUJIXEROX","FURNITURE","GOLDPOINT","GOODHANDS","HISAMITSU","HOMEDEPOT","HOMEGOODS","HOMESENSE","HONEYWELL","INSTITUTE","INSURANCE","KUOKGROUP","LADBROKES","LANCASTER","LANDROVER","LIFESTYLE","MARKETING","MARSHALLS","MCDONALDS","MELBOURNE","MICROSOFT","MONTBLANC","PANASONIC","PASSAGENS","PRAMERICA","RICHARDLI","SCJOHNSON","SHANGRILA","SOLUTIONS","STATEBANK","STATEFARM","STOCKHOLM","TRAVELERS","VACATIONS","YODOBASHI","ABUDHABI","AIRFORCE","ALLSTATE","ATTORNEY","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BOUTIQUE","BRADESCO","BROADWAY","BRUSSELS","BUDAPEST","BUILDERS","BUSINESS","CAPETOWN","CATERING","CATHOLIC","CHRYSLER","CIPRIANI","CITYEATS","CLEANING","CLINIQUE","CLOTHING","COMMBANK","COMPUTER","DELIVERY","DELOITTE","DEMOCRAT","DIAMONDS","DISCOUNT","DISCOVER","DOWNLOAD","ENGINEER","ERICSSON","ESURANCE","ETISALAT","EVERBANK","EXCHANGE","FEEDBACK","FIDELITY","FIRMDALE","FOOTBALL","FRONTIER","GOODYEAR","GRAINGER","GRAPHICS","GUARDIAN","HDFCBANK","HELSINKI","HOLDINGS","HOSPITAL","INFINITI","IPIRANGA","ISTANBUL","JPMORGAN","LIGHTING","LUNDBECK","MARRIOTT","MASERATI","MCKINSEY","MEMORIAL","MORTGAGE","MOVISTAR","OBSERVER","PARTNERS","PHARMACY","PICTURES","PLUMBING","PROPERTY","REDSTONE","RELIANCE","SAARLAND","SAMSCLUB","SECURITY","SERVICES","SHOPPING","SHOWTIME","SOFTBANK","SOFTWARE","STCGROUP","SUPPLIES","SYMANTEC","TELECITY","TRAINING","UCONNECT","VANGUARD","VENTURES","VERISIGN","WOODSIDE","YOKOHAMA","ABOGADO","ACADEMY","AGAKHAN","ALIBABA","ANDROID","ATHLETA","AUCTION","AUDIBLE","AUSPOST","AVIANCA","BANAMEX","BAUHAUS","BENTLEY","BESTBUY","BOOKING","BROTHER","BUGATTI","CAPITAL","CARAVAN","CAREERS","CARTIER","CHANNEL","CHINTAI","CITADEL","CLUBMED","COLLEGE","COLOGNE","COMCAST","COMPANY","COMPARE","CONTACT","COOKING","CORSICA","COUNTRY","COUPONS","COURSES","CRICKET","CRUISES","DENTIST","DIGITAL","DOMAINS","EXPOSED","EXPRESS","FARMERS","FASHION","FERRARI","FERRERO","FINANCE","FISHING","FITNESS","FLIGHTS","FLORIST","FLOWERS","FORSALE","FROGANS","FUJITSU","GALLERY","GENTING","GODADDY","GUITARS","HAMBURG","HANGOUT","HITACHI","HOLIDAY","HOSTING","HOTELES","HOTMAIL","HYUNDAI","ISELECT","ISMAILI","JEWELRY","JUNIPER","KITCHEN","KOMATSU","LACAIXA","LANCOME","LANXESS","LASALLE","LATROBE","LECLERC","LIAISON","LIMITED","LINCOLN","MARKETS","METLIFE","MONSTER","NETBANK","NETFLIX","NETWORK","NEUSTAR","OKINAWA","OLDNAVY","ORGANIC","ORIGINS","PANERAI","PHILIPS","PIONEER","POLITIE","REALTOR","RECIPES","RENTALS","REVIEWS","REXROTH","SAMSUNG","SANDVIK","SCHMIDT","SCHWARZ","SCIENCE","SHIKSHA","SHRIRAM","SINGLES","SPIEGEL","STAPLES","STARHUB","STATOIL","STORAGE","SUPPORT","SURGERY","SYSTEMS","TEMASEK","THEATER","THEATRE","TICKETS","TIFFANY","TOSHIBA","TRADING","WALMART","WANGGOU","WATCHES","WEATHER","WEBSITE","WEDDING","WHOSWHO","WINDOWS","WINNERS","XFINITY","YAMAXUN","YOUTUBE","ZUERICH","ABARTH","ABBOTT","ABBVIE","ACTIVE","AFRICA","AGENCY","AIRBUS","AIRTEL","ALIPAY","ALSACE","ALSTOM","ANQUAN","ARAMCO","AUTHOR","BAYERN","BEAUTY","BERLIN","BHARTI","BLANCO","BOSTIK","BOSTON","BROKER","CAMERA","CAREER","CASEIH","CASINO","CENTER","CHANEL","CHROME","CHURCH","CIRCLE","CLAIMS","CLINIC","COFFEE","COMSEC","CONDOS","COUPON","CREDIT","CRUISE","DATING","DATSUN","DEALER","DEGREE","DENTAL","DESIGN","DIRECT","DOCTOR","DUNLOP","DUPONT","DURBAN","EMERCK","ENERGY","ESTATE","EVENTS","EXPERT","FAMILY","FLICKR","FUTBOL","GALLUP","GARDEN","GEORGE","GIVING","GLOBAL","GOOGLE","GRATIS","HEALTH","HERMES","HIPHOP","HOCKEY","HOTELS","HUGHES","IMAMAT","INSURE","INTUIT","JAGUAR","JOBURG","JUEGOS","KAUFEN","KINDER","KINDLE","KOSHER","LANCIA","LATINO","LAWYER","LEFRAK","LIVING","LOCKER","LONDON","LUXURY","MADRID","MAISON","MAKEUP","MARKET","MATTEL","MOBILE","MOBILY","MONASH","MORMON","MOSCOW","MUSEUM","MUTUAL","NAGOYA","NATURA","NISSAN","NISSAY","NORTON","NOWRUZ","OFFICE","OLAYAN","ONLINE","ORACLE","ORANGE","OTSUKA","PFIZER","PHOTOS","PHYSIO","PIAGET","PICTET","QUEBEC","RACING","REALTY","REISEN","REPAIR","REPORT","REVIEW","ROCHER","ROGERS","RYUKYU","SAFETY","SAKURA","SANOFI","SCHOOL","SCHULE","SECURE","SELECT","SHOUJI","SOCCER","SOCIAL","STREAM","STUDIO","SUPPLY","SUZUKI","SWATCH","SYDNEY","TAIPEI","TAOBAO","TARGET","TATTOO","TENNIS","TIENDA","TJMAXX","TKMAXX","TOYOTA","TRAVEL","UNICOM","VIAJES","VIKING","VILLAS","VIRGIN","VISION","VOTING","VOYAGE","VUELOS","WALTER","WARMAN","WEBCAM","XIHUAN","XPERIA","YACHTS","YANDEX","ZAPPOS","ACTOR","ADULT","AETNA","AMFAM","AMICA","APPLE","ARCHI","AUDIO","AUTOS","AZURE","BAIDU","BEATS","BIBLE","BINGO","BLACK","BOATS","BOOTS","BOSCH","BUILD","CANON","CARDS","CHASE","CHEAP","CHLOE","CISCO","CITIC","CLICK","CLOUD","COACH","CODES","CROWN","CYMRU","DABUR","DANCE","DEALS","DELTA","DODGE","DRIVE","DUBAI","EARTH","EDEKA","EMAIL","EPOST","EPSON","FAITH","FEDEX","FINAL","FOREX","FORUM","GALLO","GAMES","GIFTS","GIVES","GLADE","GLASS","GLOBO","GMAIL","GREEN","GRIPE","GROUP","GUCCI","GUIDE","HOMES","HONDA","HORSE","HOUSE","HYATT","IKANO","INTEL","IRISH","IVECO","JETZT","KOELN","KYOTO","LAMER","LEASE","LEGAL","LEXUS","LILLY","LINDE","LIPSY","LIXIL","LOANS","LOCUS","LOTTE","LOTTO","LUPIN","MACYS","MANGO","MEDIA","MIAMI","MONEY","MOPAR","MOVIE","NADEX","NEXUS","NIKON","NINJA","NOKIA","NOWTV","OMEGA","OSAKA","PARIS","PARTS","PARTY","PHONE","PHOTO","PIZZA","PLACE","POKER","PRAXI","PRESS","PRIME","PROMO","QUEST","RADIO","REHAB","REISE","RICOH","ROCKS","RODEO","RUGBY","SALON","SENER","SEVEN","SHARP","SHELL","SHOES","SKYPE","SLING","SMART","SMILE","SOLAR","SPACE","STADA","STORE","STUDY","STYLE","SUCKS","SWISS","TATAR","TIRES","TIROL","TMALL","TODAY","TOKYO","TOOLS","TORAY","TOTAL","TOURS","TRADE","TRUST","TUNES","TUSHU","UBANK","VEGAS","VIDEO","VISTA","VODKA","VOLVO","WALES","WATCH","WEBER","WEIBO","WORKS","WORLD","XEROX","YAHOO","ZIPPO","local","onion","AARP","ABLE","ADAC","AERO","AIGO","AKDN","ALLY","AMEX","ARAB","ARMY","ARPA","ARTE","ASDA","ASIA","AUDI","AUTO","BABY","BAND","BANK","BBVA","BEER","BEST","BIKE","BING","BLOG","BLUE","BOFA","BOND","BOOK","BUZZ","CAFE","CALL","CAMP","CARE","CARS","CASA","CASE","CASH","CBRE","CERN","CHAT","CITI","CITY","CLUB","COOL","COOP","CYOU","DATA","DATE","DCLK","DEAL","DELL","DESI","DIET","DISH","DOCS","DOHA","DUCK","DUNS","DVAG","ERNI","FAGE","FAIL","FANS","FARM","FAST","FIAT","FIDO","FILM","FIRE","FISH","FLIR","FOOD","FORD","FREE","FUND","GAME","GBIZ","GENT","GGEE","GIFT","GMBH","GOLD","GOLF","GOOG","GUGE","GURU","HAIR","HAUS","HDFC","HELP","HERE","HGTV","HOST","HSBC","ICBC","IEEE","IMDB","IMMO","INFO","ITAU","JAVA","JEEP","JOBS","JPRS","KDDI","KIWI","KPMG","KRED","LAND","LEGO","LGBT","LIDL","LIFE","LIKE","LIMO","LINK","LIVE","LOAN","LOFT","LOVE","LTDA","LUXE","MAIF","MEET","MEME","MENU","MINI","MINT","MOBI","MODA","MOTO","NAME","NAVY","NEWS","NEXT","NICO","NIKE","OLLO","OPEN","PAGE","PARS","PCCW","PICS","PING","PINK","PLAY","PLUS","POHL","PORN","POST","PROD","PROF","QPON","RAID","READ","REIT","RENT","REST","RICH","RMIT","ROOM","RSVP","RUHR","SAFE","SALE","SAPO","SARL","SAVE","SAXO","SCOR","SCOT","SEAT","SEEK","SEXY","SHAW","SHIA","SHOP","SHOW","SILK","SINA","SITE","SKIN","SNCF","SOHU","SONG","SONY","SPOT","STAR","SURF","TALK","TAXI","TEAM","TECH","TEVA","TIAA","TIPS","TOWN","TOYS","TUBE","VANA","VISA","VIVA","VIVO","VOTE","VOTO","WANG","WEIR","WIEN","WIKI","WINE","WORK","XBOX","YOGA","ZARA","ZERO","ZONE","exit","zkey","AAA","ABB","ABC","ACO","ADS","AEG","AFL","AIG","ANZ","AOL","APP","ART","AWS","AXA","BAR","BBC","BBT","BCG","BCN","BET","BID","BIO","BIZ","BMS","BMW","BNL","BOM","BOO","BOT","BOX","BUY","BZH","CAB","CAL","CAM","CAR","CAT","CBA","CBN","CBS","CEB","CEO","CFA","CFD","COM","CRS","CSC","DAD","DAY","DDS","DEV","DHL","DIY","DNP","DOG","DOT","DTV","DVR","EAT","ECO","EDU","ESQ","EUS","FAN","FIT","FLY","FOO","FOX","FRL","FTR","FUN","FYI","GAL","GAP","GDN","GEA","GLE","GMO","GMX","GOO","GOP","GOT","GOV","HBO","HIV","HKT","HOT","HOW","HTC","IBM","ICE","ICU","IFM","ING","INK","INT","IST","ITV","IWC","JCB","JCP","JIO","JLC","JLL","JMP","JNJ","JOT","JOY","KFH","KIA","KIM","KPN","KRD","LAT","LAW","LDS","LOL","LPL","LTD","MAN","MBA","MCD","MED","MEN","MEO","MIL","MIT","MLB","MLS","MMA","MOE","MOI","MOM","MOV","MSD","MTN","MTR","NAB","NBA","NEC","NET","NEW","NFL","NGO","NHK","NOW","NRA","NRW","NTT","NYC","OBI","OFF","ONE","ONG","ONL","OOO","ORG","OTT","OVH","PAY","PET","PID","PIN","PNC","PRO","PRU","PUB","PWC","QVC","RED","REN","RIL","RIO","RIP","RUN","RWE","SAP","SAS","SBI","SBS","SCA","SCB","SES","SEW","SEX","SFR","SKI","SKY","SOY","SRL","SRT","STC","TAB","TAX","TCI","TDK","TEL","THD","TJX","TOP","TRV","TUI","TVS","UBS","UNO","UOL","UPS","VET","VIG","VIN","VIP","WED","WIN","WME","WOW","WTC","WTF","XIN","XXX","XYZ","YOU","YUN","ZIP","bit","gnu","i2p","AC","AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BM","BN","BO","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","ER","ES","ET","EU","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","ST","SU","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UK","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]},136:function(e,t,n){var i,s;/*! nanoScrollerJS - v0.8.7 - 2015
* http://jamesflorentino.github.com/nanoScrollerJS/
* Copyright (c) 2015 James Florentino; Licensed MIT */
!function(o){i=[n(3)],void 0!==(s=function(e){return o(e,window,document)}.apply(t,i))&&(e.exports=s)}(function(e,t,n){"use strict";var i,s,o,r,u,a,l,c,h,d,f,g,A,E,m,p,v,C,S,T,O,I,R,B,w,N,y,M;T={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},m="scroll",l="mousedown",c="mouseenter",h="mousemove",f="mousewheel",d="mouseup",E="resize",u="drag",a="enter",v="up",A="panedown",o="DOMMouseScroll",r="down",C="wheel",p="touchmove",i="Microsoft Internet Explorer"===t.navigator.appName&&/msie 7./i.test(t.navigator.appVersion)&&t.ActiveXObject,s=null,B=t.requestAnimationFrame,S=t.cancelAnimationFrame,N=n.createElement("div").style,M=function(){var e,t,n,i;for(t=["t","webkitT","MozT","msT","OT"],e=n=0,i=t.length;n<i;e=++n)if(t[e],t[e]+"ransform"in N)return t[e].substr(0,t[e].length-1);return!1}(),y=function(e){return!1!==M&&(""===M?e:M+e.charAt(0).toUpperCase()+e.substr(1))},w=y("transform"),I=!1!==w,O=function(){var e,t,i;return e=n.createElement("div"),t=e.style,t.position="absolute",t.width="100px",t.height="100px",t.overflow=m,t.top="-9999px",n.body.appendChild(e),i=e.offsetWidth-e.clientWidth,n.body.removeChild(e),i},R=function(){var e,n,i;return n=t.navigator.userAgent,!!(e=/(?=.+Mac OS X)(?=.+Firefox)/.test(n))&&(i=/Firefox\/\d{2}\./.exec(n),i&&(i=i[0].replace(/\D+/g,"")),e&&+i>23)},g=function(){function g(i,o){this.el=i,this.options=o,s||(s=O()),this.$el=e(this.el),this.doc=e(this.options.documentContext||n),this.win=e(this.options.windowContext||t),this.body=this.doc.find("body"),this.$content=this.$el.children("."+this.options.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return g.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===o)(t===r&&e.originalEvent.detail>0||t===v&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===f){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===r&&e.originalEvent.wheelDelta<0||t===v&&e.originalEvent.wheelDelta>0)&&e.preventDefault()}},g.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},g.prototype.updateScrollValues=function(){var e,t;e=this.content,this.maxScrollTop=e.scrollHeight-e.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=e.scrollTop,t=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!==t&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:t}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},g.prototype.setOnScrollStyles=function(){var e;I?(e={},e[w]="translate(0, "+this.sliderTop+"px)"):e={top:this.sliderTop},B?(S&&this.scrollRAF&&S(this.scrollRAF),this.scrollRAF=B(function(t){return function(){return t.scrollRAF=null,t.slider.css(e)}}(this))):this.slider.css(e)},g.prototype.createEvents=function(){this.events={down:function(e){return function(t){return e.isBeingDragged=!0,e.offsetY=t.pageY-e.slider.offset().top,e.slider.is(t.target)||(e.offsetY=0),e.pane.addClass("active"),e.doc.bind(h,e.events[u]).bind(d,e.events[v]),e.body.bind(c,e.events[a]),!1}}(this),drag:function(e){return function(t){return e.sliderY=t.pageY-e.$el.offset().top-e.paneTop-(e.offsetY||.5*e.sliderHeight),e.scroll(),e.contentScrollTop>=e.maxScrollTop&&e.prevScrollTop!==e.maxScrollTop?e.$el.trigger("scrollend"):0===e.contentScrollTop&&0!==e.prevScrollTop&&e.$el.trigger("scrolltop"),!1}}(this),up:function(e){return function(t){return e.isBeingDragged=!1,e.pane.removeClass("active"),e.doc.unbind(h,e.events[u]).unbind(d,e.events[v]),e.body.unbind(c,e.events[a]),!1}}(this),resize:function(e){return function(t){e.reset()}}(this),panedown:function(e){return function(t){return e.sliderY=(t.offsetY||t.originalEvent.layerY)-.5*e.sliderHeight,e.scroll(),e.events.down(t),!1}}(this),scroll:function(e){return function(t){e.updateScrollValues(),e.isBeingDragged||(e.iOSNativeScrolling||(e.sliderY=e.sliderTop,e.setOnScrollStyles()),null!=t&&(e.contentScrollTop>=e.maxScrollTop?(e.options.preventPageScrolling&&e.preventScrolling(t,r),e.prevScrollTop!==e.maxScrollTop&&e.$el.trigger("scrollend")):0===e.contentScrollTop&&(e.options.preventPageScrolling&&e.preventScrolling(t,v),0!==e.prevScrollTop&&e.$el.trigger("scrolltop"))))}}(this),wheel:function(e){return function(t){var n;if(null!=t)return n=t.delta||t.wheelDelta||t.originalEvent&&t.originalEvent.wheelDelta||-t.detail||t.originalEvent&&-t.originalEvent.detail,n&&(e.sliderY+=-n/3),e.scroll(),!1}}(this),enter:function(e){return function(t){var n;if(e.isBeingDragged)return 1!==(t.buttons||t.which)?(n=e.events)[v].apply(n,arguments):void 0}}(this)}},g.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(E,e[E]),this.iOSNativeScrolling||(this.slider.bind(l,e[r]),this.pane.bind(l,e[A]).bind(f+" "+o,e[C])),this.$content.bind(m+" "+f+" "+o+" "+p,e[m])},g.prototype.removeEvents=function(){var e;e=this.events,this.win.unbind(E,e[E]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(m+" "+f+" "+o+" "+p,e[m])},g.prototype.generate=function(){var e,n,i,o,r,u;return i=this.options,r=i.paneClass,u=i.sliderClass,i.contentClass,(o=this.$el.children("."+r)).length||o.children("."+u).length||this.$el.append('<div class="'+r+'"><div class="'+u+'" /></div>'),this.pane=this.$el.children("."+r),this.slider=this.pane.find("."+u),0===s&&R()?(n=t.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,""),e={right:-14,paddingRight:+n+14}):s&&(e={right:-s},this.$el.addClass("has-scrollbar")),null!=e&&this.$content.css(e),this},g.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},g.prototype.reset=function(){var e,t,n,o,r,u,a,l,c,h,d,f;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),e=this.content,o=e.style,r=o.overflowY,i&&this.$content.css({height:this.$content.height()}),t=e.scrollHeight+s,h=parseInt(this.$el.css("max-height"),10),h>0&&(this.$el.height(""),this.$el.height(e.scrollHeight>h?h:e.scrollHeight)),a=this.pane.outerHeight(!1),c=parseInt(this.pane.css("top"),10),u=parseInt(this.pane.css("bottom"),10),l=a+c+u,f=Math.round(l/t*a),f<this.options.sliderMinHeight?f=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&f>this.options.sliderMaxHeight&&(f=this.options.sliderMaxHeight),r===m&&o.overflowX!==m&&(f+=s),this.maxSliderTop=l-f,this.contentHeight=t,this.paneHeight=a,this.paneOuterHeight=l,this.sliderHeight=f,this.paneTop=c,this.slider.height(f),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&r!==m?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&r===m?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),n=this.$content.css("position"),"static"!==n&&"relative"!==n||(d=parseInt(this.$content.css("right"),10))&&this.$content.css({right:"",marginRight:d}),this)},g.prototype.scroll=function(){if(this.isActive)return this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this},g.prototype.scrollBottom=function(e){if(this.isActive)return this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(f),this.stop().restore(),this},g.prototype.scrollTop=function(e){if(this.isActive)return this.$content.scrollTop(+e).trigger(f),this.stop().restore(),this},g.prototype.scrollTo=function(e){if(this.isActive)return this.scrollTop(this.$el.find(e).get(0).offsetTop),this},g.prototype.stop=function(){return S&&this.scrollRAF&&(S(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},g.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),i&&this.$content.height(""),this.$content.removeAttr("tabindex"),this.$el.hasClass("has-scrollbar")&&(this.$el.removeClass("has-scrollbar"),this.$content.css({right:""})),this},g.prototype.flash=function(){if(!this.iOSNativeScrolling&&this.isActive)return this.reset(),this.pane.addClass("flashed"),setTimeout(function(e){return function(){e.pane.removeClass("flashed")}}(this),this.options.flashDelay),this},g}(),e.fn.nanoScroller=function(t){return this.each(function(){var n,i;if((i=this.nanoscroller)||(n=e.extend({},T,t),this.nanoscroller=i=new g(this,n)),t&&"object"==typeof t){if(e.extend(i.options,t),null!=t.scrollBottom)return i.scrollBottom(t.scrollBottom);if(null!=t.scrollTop)return i.scrollTop(t.scrollTop);if(t.scrollTo)return i.scrollTo(t.scrollTo);if("bottom"===t.scroll)return i.scrollBottom(0);if("top"===t.scroll)return i.scrollTop(0);if(t.scroll&&t.scroll instanceof e)return i.scrollTo(t.scroll);if(t.stop)return i.stop();if(t.destroy)return i.destroy();if(t.flash)return i.flash()}return i.reset()})},e.fn.nanoScroller.Constructor=g})},27:function(e,t,n){"use strict";function i(e){return e.which||e.keyCode||-1}function s(e,t){return i(e)===t}Object.defineProperty(t,"__esModule",{value:!0});var o={TAB:9,STRG:17,CTRL:17,CTRLRIGHT:18,CTRLR:18,SHIFT:16,RETURN:13,ENTER:13,BACKSPACE:8,BCKSP:8,ALT:18,ALTR:17,ALTRIGHT:17,SPACE:32,WIN:91,MAC:91,UP:38,DOWN:40,LEFT:37,RIGHT:39,ESC:27,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};t.KEYCODES=o,t.isKeyCode=s,t.getKeyCode=i},28:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t,n,s){i(this,e),this.id=t,this.name=n,this.label=s}return s(e,[{key:"toString",value:function(){return this.id}},{key:"equals",value:function(e){return 0===this.id.localeCompare(e)}}]),e}(),r={PROTECTED:new o("protected","PROTECTED","Protected"),SUBSCRIBER:new o("subscriber","SUBSCRIBER","Subscriber"),SUBSCRIBERT0:new o("flair9","SUBSCRIBERT0","Twitch subscriber"),SUBSCRIBERT1:new o("flair13","SUBSCRIBERT1","Subscriber (T1)"),SUBSCRIBERT2:new o("flair1","SUBSCRIBERT2","Subscriber (T2)"),SUBSCRIBERT3:new o("flair3","SUBSCRIBERT3","Subscriber (T3)"),SUBSCRIBERT4:new o("flair8","SUBSCRIBERT4","Subscriber (T4)"),VIP:new o("vip","VIP","VIP"),MODERATOR:new o("moderator","MODERATOR","Moderator"),ADMIN:new o("admin","ADMIN","Admin"),BROADCASTER:new o("flair12","BROADCASTER","Broadcaster"),BOT:new o("bot","BOT","Bot"),BOT2:new o("flair11","BOT2","Bot2"),NOTABLE:new o("flair2","NOTABLE","Notable"),TRUSTED:new o("flair4","TRUSTED","Trusted"),CONTRIBUTOR:new o("flair5","CONTRIBUTOR","Contributor"),COMPCHALLENGE:new o("flair6","COMPCHALLENGE","Composition winner"),EVE:new o("flair7","EVE","EVE"),SC2:new o("flair10","SC2","Starcraft 2")},u=new Map([["protected",r.PROTECTED],["subscriber",r.SUBSCRIBER],["flair9",r.SUBSCRIBERT0],["flair1",r.SUBSCRIBERT2],["flair13",r.SUBSCRIBERT1],["flair3",r.SUBSCRIBERT3],["flair8",r.SUBSCRIBERT4],["vip",r.VIP],["moderator",r.MODERATOR],["admin",r.ADMIN],["flair12",r.BROADCASTER],["bot",r.BOT],["flair11",r.BOT2],["flair2",r.NOTABLE],["flair4",r.TRUSTED],["flair5",r.CONTRIBUTOR],["flair6",r.COMPCHALLENGE],["flair7",r.EVE],["flair10",r.SC2]]);r.valueOf=function(e){return u.get(e.toLowerCase())||null},t.default=r},314:function(e,t,n){"use strict";(function(e){n(26),n(25),n(74);var t=n(53).default,i=n(78),s="ws"+("https:"===window.location.protocol?"s":"")+"://"+window.location.host+"/ws";e.when(new Promise(function(t){return e.getJSON({url:"/api/chat/me",timeout:5e3}).done(t).fail(function(){return t(null)})}),new Promise(function(t){return e.getJSON({url:"/api/chat/history",timeout:5e3}).done(t).fail(function(){return t(null)})})).then(function(e,n){return(new t).withUserAndSettings(e).withEmotes(i).withGui().withHistory(n).withWhispers().connect(s)})}).call(t,n(3))},43:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this.listeners=new Map}return s(e,[{key:"on",value:function(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),this}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this.listeners.get(e);return!(!s||!s.length)&&(s.forEach(function(e){return e.apply(void 0,n)}),!0)}}]),e}();t.default=o},44:function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=window.localStorage||{},u=window.JSON,a=function(){function e(){s(this,e)}return o(e,null,[{key:"write",value:function(e,t){var n="";try{n=u.stringify(t instanceof Map||t instanceof Set?[].concat(i(t)):t)}catch(e){console.error(e)}r.setItem(e,n)}},{key:"read",value:function(e){var t=null;try{t=u.parse(r.getItem(e))}catch(e){console.error(e)}return t}},{key:"remove",value:function(e){try{r.removeItem(e)}catch(e){console.error(e)}}}]),e}();t.default=a},53:function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(27),l=n(71),c=i(l),h=n(0),d=i(h),f=n(43),g=i(f),A=n(95),E=i(A),m=n(66),p=i(m),v=n(64),C=n(93),S=n(89),T=i(S),O=n(92),I=i(O),R=n(90),B=i(R),w=n(44),N=i(w),y=n(28),M=i(y),F=n(94),D=i(F),L=n(67),b=i(L),k=/(?:(?:^|\s)@?)([a-zA-Z0-9_]{3,20})(?=$|\s|[\.\?!,])/g,U=/^[a-zA-Z0-9_]{3,20}$/,P=["green","yellow","orange","red","purple","blue","sky","lime","pink","black"],H=new Map([["unknown","Unknown error, this usually indicates an internal problem :("],["nopermission","You do not have the required permissions to use that"],["protocolerror","Invalid or badly formatted"],["needlogin","You have to be logged in to use that"],["invalidmsg","The message was invalid"],["throttled","Throttled! You were trying to send messages too fast"],["duplicate","The message is identical to the last one you sent"],["muted","You are muted (subscribing removes mutes). Check your profile for more information."],["submode","The channel is currently in subscriber only mode"],["needbanreason","Providing a reason for the ban is mandatory"],["banned","You have been banned (subscribing removes non-permanent bans). Check your profile for more information."],["privmsgbanned","Cannot send private messages while banned"],["requiresocket","This chat requires WebSockets"],["toomanyconnections","Only 5 concurrent connections allowed"],["socketerror","Error contacting server"],["privmsgaccounttooyoung","Your account is too recent to send private messages"],["notfound","The user was not found"],["notconnected","You have to be connected to use that"]]),G=new Map([["slashhelp","Type in /help for more a list of commands, do advanced things like modify your scroll-back size"],["tabcompletion","Use the tab key to auto-complete usernames and emotes (for user only completion prepend a @ or press shift)"],["hoveremotes","Hovering your mouse over an emote will show you the emote code"],["highlight","Chat messages containing your username will be highlighted"],["notify","Use /msg <username> to send a private message to someone"],["ignoreuser","Use /ignore <username> to hide messages from pesky chatters"],["mutespermanent","Mutes are never persistent, don't worry it will pass!"],["stalkmentionshint","Use the /stalk <nick> or /mentions <nick> to keep up to date"],["tagshint","Use the /tag <nick> <color> to highlight users you like. There are preset colors to choose from "+P.join(", ")],["bigscreen","Bigscreen! Did you know you can have the chat on the left or right side of the stream by clicking the swap icon in the top left?"]]),x=new Map([["schemaversion",1],["showtime",!1],["hideflairicons",!1],["profilesettings",!1],["timestampformat","HH:mm"],["maxlines",250],["notificationwhisper",!1],["notificationhighlight",!1],["highlight",!0],["customhighlight",[]],["highlightnicks",[]],["taggednicks",[]],["showremoved",!1],["showhispersinchat",!1],["ignorenicks",[]],["focusmentioned",!1],["notificationtimeout",!0],["ignorementions",!1],["autocompletehelper",!0]]),Y=new Map([["help",{description:"Helpful information."}],["emotes",{description:"A list of the chats emotes in text form."}],["me",{description:"A normal message, but emotive."}],["message",{description:"Whisper someone",alias:["msg","whisper","w","tell","t","notify"]}],["ignore",{description:"No longer see user messages, without <nick> to list the nicks ignored"}],["unignore",{description:"Remove a user from your ignore list"}],["highlight",{description:"Highlights target nicks messages for easier visibility"}],["unhighlight",{description:"Unhighlight target nick"}],["maxlines",{description:"The maximum number of lines the chat will store"}],["mute",{description:"The users messages will be blocked from everyone.",admin:!0}],["unmute",{description:"Unmute the user.",admin:!0}],["subonly",{description:"Subscribers only",admin:!0}],["ban",{description:"User will no longer be able to connect to the chat.",admin:!0}],["unban",{description:"Unban a user",admin:!0}],["timestampformat",{description:"Set the time format of the chat."}],["stalk",{description:"Return a list of messages from <nick>",alias:["s"]}],["mentions",{description:"Return a list of messages where <nick> is mentioned",alias:["m"]}],["tag",{description:"Mark a users messages"}],["untag",{description:"No longer mark the users messages"}],["close",{description:"Exit the conversation"}]]),K={id:0,userid:0,username:"",targetuserid:"",targetusername:"",ipaddress:"",reason:"",starttimestamp:"",endtimestamp:""},W=(0,c.default)(function(e){return e.input.focus()},10),V=function(e){var t=void 0;return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0]},_=function(e){window.getSelection().isCollapsed&&!e.input.is(":focus")&&W(e)},j=function(){function t(){var e=this;o(this,t),this.uri="",this.ui=null,this.css=null,this.output=null,this.input=null,this.loginscrn=null,this.loadingscrn=null,this.popoutbtn=null,this.reconnect=!0,this.connected=!1,this.lastmessage=null,this.showmotd=!0,this.authenticated=!1,this.backlogloading=!1,this.unresolved=[],this.emoticons=new Set,this.twitchemotes=new Set,this.control=new g.default(this),this.source=new E.default,this.user=new p.default,this.users=new Map,this.whispers=new Map,this.windows=new Map,this.settings=new Map([].concat(s(x))),this.autocomplete=new T.default,this.menus=new Map,this.taggednicks=new Map,this.ignoring=new Set,this.regexhighlightcustom=null,this.regexhighlightnicks=null,this.regexhighlightself=null,this.source.on("PING",function(t){return e.source.send("PONG",t)}),this.source.on("OPEN",function(t){return e.connected=!0}),this.source.on("REFRESH",function(e){return window.location.reload(!1)}),this.source.on("CONNECTING",function(t){return v.MessageBuilder.status("Connecting...").into(e)}),this.source.on("DISPATCH",function(t){return e.onDISPATCH(t)}),this.source.on("CLOSE",function(t){return e.onCLOSE(t)}),this.source.on("NAMES",function(t){return e.onNAMES(t)}),this.source.on("QUIT",function(t){return e.onQUIT(t)}),this.source.on("MSG",function(t){return e.onMSG(t)}),this.source.on("MUTE",function(t){return e.onMUTE(t)}),this.source.on("UNMUTE",function(t){return e.onUNMUTE(t)}),this.source.on("BAN",function(t){return e.onBAN(t)}),this.source.on("UNBAN",function(t){return e.onUNBAN(t)}),this.source.on("ERR",function(t){return e.onERR(t)}),this.source.on("SUBONLY",function(t){return e.onSUBONLY(t)}),this.source.on("BROADCAST",function(t){return e.onBROADCAST(t)}),this.control.on("SEND",function(t){return e.cmdSEND(t)}),this.control.on("HINT",function(t){return e.cmdHINT(t)}),this.control.on("EMOTES",function(t){return e.cmdEMOTES(t)}),this.control.on("HELP",function(t){return e.cmdHELP(t)}),this.control.on("IGNORE",function(t){return e.cmdIGNORE(t)}),this.control.on("UNIGNORE",function(t){return e.cmdUNIGNORE(t)}),this.control.on("MUTE",function(t){return e.cmdMUTE(t)}),this.control.on("BAN",function(t){return e.cmdBAN(t,"BAN")}),this.control.on("IPBAN",function(t){return e.cmdBAN(t,"IPBAN")}),this.control.on("UNMUTE",function(t){return e.cmdUNBAN(t,"UNMUTE")}),this.control.on("UNBAN",function(t){return e.cmdUNBAN(t,"UNBAN")}),this.control.on("SUBONLY",function(t){return e.cmdSUBONLY(t,"SUBONLY")}),this.control.on("MAXLINES",function(t){return e.cmdMAXLINES(t,"MAXLINES")}),this.control.on("UNHIGHLIGHT",function(t){return e.cmdHIGHLIGHT(t,"UNHIGHLIGHT")}),this.control.on("HIGHLIGHT",function(t){return e.cmdHIGHLIGHT(t,"HIGHLIGHT")}),this.control.on("TIMESTAMPFORMAT",function(t){return e.cmdTIMESTAMPFORMAT(t)}),this.control.on("BROADCAST",function(t){return e.cmdBROADCAST(t)}),this.control.on("CONNECT",function(t){return e.cmdCONNECT(t)}),this.control.on("TAG",function(t){return e.cmdTAG(t)}),this.control.on("UNTAG",function(t){return e.cmdUNTAG(t)}),this.control.on("BANINFO",function(t){return e.cmdBANINFO(t)}),this.source.on("PRIVMSGSENT",function(t){return e.onPRIVMSGSENT(t)}),this.source.on("PRIVMSG",function(t){return e.onPRIVMSG(t)}),this.control.on("MESSAGE",function(t){return e.cmdWHISPER(t)}),this.control.on("MSG",function(t){return e.cmdWHISPER(t)}),this.control.on("WHISPER",function(t){return e.cmdWHISPER(t)}),this.control.on("W",function(t){return e.cmdWHISPER(t)}),this.control.on("TELL",function(t){return e.cmdWHISPER(t)}),this.control.on("T",function(t){return e.cmdWHISPER(t)}),this.control.on("NOTIFY",function(t){return e.cmdWHISPER(t)}),this.control.on("MENTIONS",function(t){return e.cmdMENTIONS(t)}),this.control.on("M",function(t){return e.cmdMENTIONS(t)}),this.control.on("STALK",function(t){return e.cmdSTALK(t)}),this.control.on("S",function(t){return e.cmdSTALK(t)})}return u(t,[{key:"withUserAndSettings",value:function(e){return this.withUser(e).withSettings(e&&e.hasOwnProperty("settings")?new Map(e.settings):new Map)}},{key:"withUser",value:function(e){return this.user=this.addUser(e||{nick:"Anonymous"}),this.authenticated=null!==this.user&&""!==this.user.username&&"Anonymous"!==this.user.username,this}},{key:"withSettings",value:function(e){var t=this,n=this.authenticated&&e.get("profilesettings")?e:new Map(N.default.read("chat.settings")||[]);n.size>0&&[].concat(s(this.settings.keys())).filter(function(e){return void 0!==n.get(e)&&null!==n.get(e)}).forEach(function(e){return t.settings.set(e,n.get(e))});var i=parseInt(n.get("schemaversion")||-1),o=x.get("schemaversion");return-1!==i&&o!==i&&D.default.upgrade(this,i,o),this.taggednicks=new Map(this.settings.get("taggednicks")),this.ignoring=new Set(this.settings.get("ignorenicks")),this}},{key:"withGui",value:function(){var t=this;this.ui=e("#chat"),this.css=e("#chat-styles")[0].sheet,this.output=this.ui.find("#chat-output-frame"),this.input=this.ui.find("#chat-input-control"),this.loginscrn=this.ui.find("#chat-login-screen"),this.loadingscrn=this.ui.find("#chat-loading"),this.popoutbtn=this.ui.find("#chat-popout-btn"),this.windowselect=this.ui.find("#chat-windows-thumbnails"),this.inputhistory=new I.default(this),this.userfocus=new B.default(this,this.css),this.mainwindow=new b.default("main").into(this),this.menus.set("settings",new C.ChatSettingsMenu(this.ui.find("#chat-settings"),this.ui.find("#chat-settings-btn"),this)),this.menus.set("emotes",new C.ChatEmoteMenu(this.ui.find("#chat-emote-list"),this.ui.find("#chat-emoticon-btn"),this)),this.menus.set("users",new C.ChatUserMenu(this.ui.find("#chat-user-list"),this.ui.find("#chat-users-btn"),this)),this.menus.set("whisper-users",new C.ChatWhisperUsers(this.ui.find("#chat-whisper-users"),this.ui.find("#chat-whisper-btn"),this)),Y.forEach(function(e,n){t.autocomplete.add("/"+n),(e.alias||[]).forEach(function(e){return t.autocomplete.add("/"+e)})}),this.emoticons.forEach(function(e){return t.autocomplete.add(e,!0)}),this.twitchemotes.forEach(function(e){return t.autocomplete.add(e,!0)}),this.autocomplete.bind(this),this.applySettings(!1),this.input.on("keypress",function(e){!(0,a.isKeyCode)(e,a.KEYCODES.ENTER)||e.shiftKey||e.ctrlKey||(e.preventDefault(),e.stopPropagation(),t.authenticated?(t.control.emit("SEND",t.input.val().toString().trim()),t.input.val("").focus()):(t.loginscrn.show(),t.input.blur()))}),this.output.on("mouseup",function(){C.ChatMenu.closeMenus(t),_(t)}),document.addEventListener("keydown",function(e){(0,a.isKeyCode)(e,a.KEYCODES.ESC)&&C.ChatMenu.closeMenus(t)}),document.addEventListener("visibilitychange",(0,c.default)(function(){"visible"===(document.visibilityState||"visible")?_(t):C.ChatMenu.closeMenus(t)},100),!0);var n=!1,i=(0,c.default)(function(){n=!1,t.getActiveWindow().unlock(),_(t)},100),s=function(){n||(n=!0,C.ChatMenu.closeMenus(t),t.getActiveWindow().lock()),i()};window.addEventListener("resize",s,!1),this.windowselect.on("click",".ctrl",function(n){C.ChatMenu.closeMenus(t);var i=e(n.currentTarget);return i.hasClass("active")?i.hasClass("win-main")||(i.hasClass("select")?t.removeWindow(n.target.getAttribute("data-name").toLowerCase()):i.addClass("select")):t.windowToFront(n.target.getAttribute("data-name").toLowerCase()),t.input.focus(),!1}),this.output.on("click",".censored",function(t){return e(t.currentTarget).removeClass("censored"),!1}),this.loginscrn.on("click","#chat-btn-login",function(){var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");try{if(window.self!==window.top)return void(window.parent.location.href=e+"/login?follow="+encodeURIComponent(window.parent.location.pathname))}catch(e){}window.location.href=e+"/login?follow="+encodeURIComponent(window.location.pathname),t.loginscrn.hide()}),this.loginscrn.on("click","#chat-btn-cancel",function(){return t.loginscrn.hide()}),this.output.on("click",".chat-open-whisper",function(n){var i=e(n.target).closest(".msg-chat"),s=i.data("username").toString().toLowerCase();return t.whispers.has(s)&&t.menus.get("whisper-users").selectConversation(s),!1}),this.output.on("click",".chat-remove-whisper",function(n){t.mainwindow.lock();var i=e(n.target).closest(".msg-chat"),s=i.data("username").toString().toLowerCase(),o=i.data("id");if(null!==o&&t.whispers.has(s)){t.whispers.get(s).messages.filter(function(e){return e.id===o}).length>0&&(e.ajax({url:"/api/messages/"+encodeURIComponent(o)+"/open",method:"get"}),i.remove(),t.menus.get("whisper-users").redraw())}return t.mainwindow.unlock(),!1});try{var o=V(document.referrer);window.self!==window.top&&0!==o.localeCompare(window.location.hostname)?this.popoutbtn.on("click",function(){return window.open("/embed/chat","_blank","height=500,width=420,scrollbars=0,toolbar=0,location=0,status:no,menubar:0,resizable:0,dependent:0"),v.MessageBuilder.info("Disconnecting... Good bye.").into(t),t.reconnect=!1,t.source.disconnect(),!1}).show():this.popoutbtn.remove()}catch(e){this.popoutbtn.remove(),console.error(e)}return setInterval(function(){return e.ajax({url:"/ping"})},6e5),v.MessageBuilder.broadcast("SOmeone has subscribed.").into(this),this.loadingscrn.fadeOut(500,function(){return t.loadingscrn.remove()}),this.mainwindow.updateAndPin(),this.input.focus(),this}},{key:"withEmotes",value:function(e){return this.emoticons=new Set(e.destiny),this.twitchemotes=new Set(e.twitch),this}},{key:"withHistory",value:function(e){var t=this;return e&&e.length>0&&(this.backlogloading=!0,e.forEach(function(e){return t.source.parseAndDispatch({data:e})}),this.backlogloading=!1,v.MessageBuilder.element("<hr/>").into(this),this.mainwindow.updateAndPin()),this}},{key:"withWhispers",value:function(){var t=this;return this.authenticated&&e.ajax({url:"/api/messages/inbox"}).done(function(e){return e.forEach(function(e){return t.whispers.set(e.username.toLowerCase(),{id:e.messageid,nick:e.username,unread:e.unread,messages:[],loaded:!1})})}).always(function(e){return t.menus.get("whisper-users").redraw()}),this}},{key:"connect",value:function(e){return this.uri=e,this.source.connect(e),this}},{key:"saveSettings",value:function(){this.authenticated&&this.settings.get("profilesettings")?e.ajax({url:"/api/chat/me/settings",method:"post",data:JSON.stringify([].concat(s(this.settings)))}):N.default.write("chat.settings",this.settings)}},{key:"commitSettings",value:function(){var e=this;this.debouncedsave||(this.debouncedsave=(0,c.default)(function(){return e.saveSettings()},1e3,!1)),this.debouncedsave()}},{key:"applySettings",value:function(){var e=this;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.saveSettings(),v.MessageGlobals.timeformat=this.settings.get("timestampformat");var n=Array.from(this.ignoring.values()).map(t.makeSafeForRegex);this.ignoreregex=n.length>0?new RegExp("\\b(?:"+n.join("|")+")\\b","i"):null;var i=[].concat(s(this.settings.get("customhighlight")||[])).filter(function(e){return""!==e}),o=[].concat(s(this.settings.get("highlightnicks")||[])).filter(function(e){return""!==e});this.regexhighlightself=this.user.nick?new RegExp("\\b(?:"+this.user.nick+")\\b","i"):null,this.regexhighlightcustom=i.length>0?new RegExp("\\b(?:"+i.join("|")+")\\b","i"):null,this.regexhighlightnicks=o.length>0?new RegExp("\\b(?:"+o.join("|")+")\\b","i"):null,Array.from(this.settings.keys()).filter(function(t){return"boolean"==typeof e.settings.get(t)}).forEach(function(t){return e.ui.toggleClass("pref-"+t,e.settings.get(t))}),[].concat(s(this.windows)).forEach(function(t){return t.maxlines=e.settings.get("maxlines")})}},{key:"addUser",value:function(e){if(!e)return null;var n=e.nick.toLowerCase(),i=this.users.get(n);return i?e.hasOwnProperty("features")&&!t.isArraysEqual(e.features,i.features)&&(i.features=e.features):(i=new p.default(e),this.users.set(n,i)),i}},{key:"addMessage",value:function(n){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n.type!==v.MessageTypes.USER||!this.ignored(n.user.nick,n.message))return null===s&&(s=this.mainwindow),s.lock(),this.lastmessage&&this.lastmessage.type===v.MessageTypes.EMOTE&&this.lastmessage.emotecount>1&&this.lastmessage.completeCombo(),this.lastmessage&&this.lastmessage.type===n.type&&[v.MessageTypes.ERROR,v.MessageTypes.INFO,v.MessageTypes.COMMAND,v.MessageTypes.STATUS].indexOf(n.type)&&(n.continued=!0),n.type===v.MessageTypes.USER&&(n.message="//"===n.message.substring(0,2)?n.message.substring(1):n.message,n.slashme="/me "===n.message.substring(0,4).toLowerCase(),n.isown=n.user.username.toLowerCase()===this.user.username.toLowerCase(),n.continued=this.lastmessage&&this.lastmessage.user&&this.lastmessage.user.username.toLowerCase()===n.user.username.toLowerCase(),n.mentioned=t.extractNicks(n.message).filter(function(e){return i.users.has(e.toLowerCase())}),n.tag=this.taggednicks.get(n.user.nick.toLowerCase()),n.highlighted=!n.isown&&!n.user.hasFeature(M.default.BOT)&&(this.regexhighlightself&&this.settings.get("highlight")&&this.regexhighlightself.test(n.message)||this.regexhighlightnicks&&this.regexhighlightnicks.test(n.user.username)||this.regexhighlightcustom&&this.regexhighlightcustom.test(n.user.username+" "+n.message))),n.ui=e(n.html(this)),s.addline(n.ui),s.cleanup(),!this.backlogloading&&n.highlighted&&this.settings.get("notificationhighlight")&&!this.input.is(":focus")&&t.showNotification(n.user.username+" said ...",n.message,n.timestamp.valueOf(),this.settings.get("notificationtimeout")),this.lastmessage=n,s.unlock(),n}},{key:"resolveMessage",value:function(e,t){var n=!0,i=!1,s=void 0;try{for(var o,r=this.unresolved[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var u=o.value;if(this.user.username.toLowerCase()===e.toLowerCase()&&u.message===t)return this.unresolved.splice(this.unresolved.indexOf(u),1),!0}}catch(e){i=!0,s=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw s}}return!1}},{key:"removeMessageByNick",value:function(e){this.mainwindow.lock(),this.mainwindow.removelines('.msg-chat[data-username="'+e.toLowerCase()+'"]'),this.mainwindow.unlock()}},{key:"windowToFront",value:function(e){this.windows.forEach(function(e){e.visible&&(e.locked()||e.lock(),e.hide())});var t=this.windows.get(e);t.show(),t.locked()&&t.unlock(),this.redrawWindowIndicators()}},{key:"getActiveWindow",value:function(){return[].concat(s(this.windows.values())).filter(function(e){return e.visible})[0]}},{key:"getWindow",value:function(e){return this.windows.get(e)}},{key:"addWindow",value:function(e,t){this.windows.set(e,t),this.redrawWindowIndicators()}},{key:"removeWindow",value:function(e){var t=this.windows.get(e);if(t){var n=t.visible;if(this.windows.delete(e),t.destroy(),n){var i=[].concat(s(this.windows.keys()));this.windowToFront(this.windows.get(i[i.length-1]).name)}else this.redrawWindowIndicators()}}},{key:"redrawWindowIndicators",value:function(){var e=this;this.windowselect.empty(),this.windows.size>1&&this.windows.forEach(function(t){e.windowselect.append('<span title="'+t.label+'" data-name="'+t.name+'" class="ctrl win-'+t.name+" tag-"+t.tag+" "+(t.visible?"active":"")+'">                        <i class="fa fa-times" data-name="'+t.name+'"></i>\n                     </span>')})}},{key:"censor",value:function(e){this.mainwindow.lock();var t=this.mainwindow.getlines('.msg-chat[data-username="'+e.toLowerCase()+'"]');this.settings.get("showremoved")?t.addClass("censored"):t.remove(),this.mainwindow.unlock()}},{key:"ignored",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.ignoring.has(e.toLowerCase())||this.ignoreregex&&null!==t&&this.settings.get("ignorementions")&&this.ignoreregex.test(t)}},{key:"ignore",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=e.toLowerCase();var n=this.ignoring.has(e);t&&!n?this.ignoring.add(e):!t&&n&&this.ignoring.delete(e),this.settings.set("ignorenicks",[].concat(s(this.ignoring))),this.applySettings()}},{key:"onDISPATCH",value:function(e){var t=this,n=e.data;if("object"===(void 0===n?"undefined":r(n))){var i=[],s=Date.now();n.hasOwnProperty("nick")&&i.push(this.addUser(n)),n.hasOwnProperty("users")&&(i=i.concat(n.users.map(function(e){return t.addUser(e)}))),i.forEach(function(e){return t.autocomplete.weight(e.nick,s)})}}},{key:"onCLOSE",value:function(){var e=this,t=this.connected;if(this.connected=!1,this.reconnect){var n=t?Math.floor(2500*Math.random())+501:Math.floor(25001*Math.random())+5e3;setTimeout(function(){e.connected||e.connect(e.uri)},n),v.MessageBuilder.status("Disconnected... reconnecting in "+Math.round(n/1e3)+" seconds").into(this)}}},{key:"onNAMES",value:function(e){v.MessageBuilder.status("Connected. Server connections: "+e.connectioncount).into(this),this.showmotd&&(this.cmdHINT([Math.floor(Math.random()*G.size)]),this.showmotd=!1)}},{key:"onQUIT",value:function(e){var t=e.nick.toLowerCase();this.users.has(t)&&(this.users.delete(t),this.autocomplete.remove(e.nick))}},{key:"onMSG",value:function(e){var n=t.extractTextOnly(e.data);(this.emoticons.has(n)||this.twitchemotes.has(n))&&null!==this.lastmessage&&t.extractTextOnly(this.lastmessage.message)===n?this.lastmessage.type===v.MessageTypes.EMOTE?(this.mainwindow.lock(),this.lastmessage.incEmoteCount(),this.mainwindow.unlock()):(this.lastmessage.ui.remove(),v.MessageBuilder.emote(n,e.timestamp,2).into(this)):this.resolveMessage(e.nick,e.data)||v.MessageBuilder.message(e.data,this.users.get(e.nick.toLowerCase()),e.timestamp).into(this)}},{key:"onMUTE",value:function(e){this.censor(e.data),this.user.username.toLowerCase()===e.data.toLowerCase()?v.MessageBuilder.command("You have been muted by "+e.nick+".",e.timestamp).into(this):v.MessageBuilder.command(e.data+" muted by "+e.nick+".",e.timestamp).into(this)}},{key:"onUNMUTE",value:function(e){this.user.username.toLowerCase()===e.data.toLowerCase()?v.MessageBuilder.command("You have been unmuted by "+e.nick+".",e.timestamp).into(this):v.MessageBuilder.command(e.data+" unmuted by "+e.nick+".",e.timestamp).into(this)}},{key:"onBAN",value:function(e){this.user.username.toLowerCase()===e.data.toLowerCase()?(v.MessageBuilder.command("You have been banned by "+e.nick+". Check your profile for more information.",e.timestamp).into(this),this.cmdBANINFO()):v.MessageBuilder.command(e.data+" banned by "+e.nick+".",e.timestamp).into(this),this.censor(e.data)}},{key:"onUNBAN",value:function(e){this.user.username.toLowerCase()===e.data.toLowerCase()?v.MessageBuilder.command("You have been unbanned by "+e.nick+".",e.timestamp).into(this):v.MessageBuilder.command(e.data+" unbanned by "+e.nick+".",e.timestamp).into(this)}},{key:"onERR",value:function(e){this.reconnect="toomanyconnections"!==e&&"banned"!==e;var t=H.has(e)?H.get(e):e,n=this.getActiveWindow();v.MessageBuilder.error(t).into(this,n),n!==this.mainwindow&&v.MessageBuilder.error(t).into(this)}},{key:"onSUBONLY",value:function(e){var t="on"===e.data?"enabled":"disabled";v.MessageBuilder.command("Subscriber only mode "+t+" by "+e.nick,e.timestamp).into(this)}},{key:"onBROADCAST",value:function(e){v.MessageBuilder.broadcast(e.data,e.timestamp).into(this)}},{key:"onPRIVMSGSENT",value:function(){this.mainwindow.visible&&v.MessageBuilder.info("Your message has been sent.").into(this)}},{key:"onPRIVMSG",value:function(e){var n=e.nick.toLowerCase();if(!this.ignoring.has(n)){var i=this.users.get(n)||new p.default({nick:e.nick}),s=e.hasOwnProperty("messageid")?e.messageid:null,o={data:e.data,timestamp:e.timestamp,read:!1,nick:e.nick,id:s},r=this.whispers.get(n)||{nick:e.nick,unread:0,messages:[],loaded:!0};this.whispers.set(n,r),o.read||r.unread++,r.loaded&&r.messages.push(o);var u=this.getWindow(n);u&&v.MessageBuilder.historical(e.data,i,e.timestamp).into(this,u),this.settings.get("showhispersinchat")&&v.MessageBuilder.whisper(e.data,i,this.user.username,e.timestamp,s).into(this),this.settings.get("notificationwhisper")&&!this.input.is(":focus")&&t.showNotification(e.nick+" whispered ...",e.data,e.timestamp,this.settings.get("notificationtimeout")),this.menus.get("whisper-users").redraw()}}},{key:"cmdSEND",value:function(e){if(""!==e){var t="/me "===e.substring(0,4).toLowerCase(),n="/"===e.substring(0,1)&&"//"!==e.substring(0,2),i=n?e.split(" ",1)[0]:"";if(this.mainwindow.visible)if(!t&&n){var s=(e.substring(i.length+1)||"").match(/([^ ]+)/g),o=i.substring(1).toUpperCase();this.control.listeners.has(o)?this.control.emit(o,s||[]):v.MessageBuilder.error("Unknown command. Try /help").into(this),this.inputhistory.add(e)}else{var r=(t?e.substring(4):e).trim();if(this.connected&&!this.emoticons.has(r)&&!this.twitchemotes.has(r)){var u=v.MessageBuilder.message(e,this.user).into(this);this.unresolved.unshift(u)}this.source.send("MSG",{data:e}),this.inputhistory.add(e)}else{var a=this.getActiveWindow();/^\/close/i.test(i)&&this.mainwindow!==a?(this.removeWindow(a.name),this.inputhistory.add(e)):!t&&n?v.MessageBuilder.error("No commands in private channels yet.").into(this,a):this.source.connected()?(this.source.send("PRIVMSG",{nick:a.name,data:e}),v.MessageBuilder.message(e,this.user).into(this,a)):v.MessageBuilder.error(H.get("notconnected")).into(this,a)}}}},{key:"cmdEMOTES",value:function(){v.MessageBuilder.info("Available emoticons: "+this.emoticons.join(", ")+" (www.destiny.gg/emotes)").into(this)}},{key:"cmdHELP",value:function(){var e="Available commands: \r";Y.forEach(function(t,n){e+=" /"+n+" - "+t.description+" \r"}),v.MessageBuilder.info(e).into(this)}},{key:"cmdHINT",value:function(e){var t=[].concat(s(G)),n=e&&e[0]?parseInt(e[0])-1:-1;n>0&&n<G.size?v.MessageBuilder.info(t[n][1]).into(this):(void 0===this.lasthintindex||this.lasthintindex===t.length-1?this.lasthintindex=0:this.lasthintindex++,v.MessageBuilder.info(t[this.lasthintindex][1]).into(this))}},{key:"cmdIGNORE",value:function(e){var t=e[0]||null;t?U.test(t)?(this.ignore(t,!0),this.removeMessageByNick(t),v.MessageBuilder.status("Ignoring "+t).into(this)):v.MessageBuilder.info("Invalid nick - /ignore <nick>").into(this):this.ignoring.size<=0?v.MessageBuilder.info("Your ignore list is empty").into(this):v.MessageBuilder.info("Ignoring the following people: "+Array.from(this.ignoring.values()).join(", ")).into(this)}},{key:"cmdUNIGNORE",value:function(e){var t=e[0]||null;t&&U.test(t)?(this.ignore(t,!1),v.MessageBuilder.status(t+" has been removed from your ignore list").into(this)):v.MessageBuilder.error("Invalid nick - /ignore <nick>").into(this)}},{key:"cmdMUTE",value:function(e){if(0===e.length)v.MessageBuilder.info("Usage: /mute <nick>[ <time>]").into(this);else if(U.test(e[0])){var n=e[1]?t.parseTimeInterval(e[1]):null;n&&n>0?this.source.send("MUTE",{data:e[0],duration:n}):this.source.send("MUTE",{data:e[0]})}else v.MessageBuilder.info("Invalid nick - /mute <nick>[ <time>]").into(this)}},{key:"cmdBAN",value:function(e,n){if(0===e.length||e.length<3)v.MessageBuilder.info("Usage: /"+n+" <nick> <time> <reason> (time can be 'permanent')").into(this);else if(U.test(e[0]))if(e[2]){var i={nick:e[0],reason:e.slice(2,e.length).join(" ")};"IPBAN"===n||/^perm/i.test(e[1])?i.ispermanent="IPBAN"===n||/^perm/i.test(e[1]):i.duration=t.parseTimeInterval(e[1]),this.source.send("BAN",i)}else v.MessageBuilder.error("Providing a reason is mandatory").into(this);else v.MessageBuilder.info("Invalid nick").into(this)}},{key:"cmdUNBAN",value:function(e,t){0===e.length?v.MessageBuilder.info("Usage: /"+t+" nick").into(this):U.test(e[0])?this.source.send(t,{data:e[0]}):v.MessageBuilder.info("Invalid nick").into(this)}},{key:"cmdSUBONLY",value:function(e,t){/on|off/i.test(e[0])?this.source.send(t.toUpperCase(),{data:e[0].toLowerCase()}):v.MessageBuilder.error("Invalid argument - /"+t.toLowerCase()+" on | off").into(this)}},{key:"cmdMAXLINES",value:function(e,t){if(0===e.length)return void v.MessageBuilder.info("Maximum lines stored: "+this.settings.get("maxlines")).into(this);var n=Math.abs(parseInt(e[0],10));n?(v.MessageBuilder.info("Current number of lines shown: "+this.settings.get("maxlines")).into(this),this.settings.set("maxlines",n),this.applySettings()):v.MessageBuilder.info("Invalid argument - /"+t+" is expecting a number").into(this)}},{key:"cmdHIGHLIGHT",value:function(e,t){var n=this.settings.get("highlightnicks");if(0===e.length)return void(n.length>0?v.MessageBuilder.info("Currently highlighted users: "+n.join(",")).into(this):v.MessageBuilder.info("No highlighted users").into(this));U.test(e[0])||v.MessageBuilder.error("Invalid nick - /"+t+" nick").into(this);var i=e[0].toLowerCase(),s=n.indexOf(i);switch(t){case"UNHIGHLIGHT":-1!==s&&n.splice(s,1);break;default:case"HIGHLIGHT":-1===s&&n.push(i)}v.MessageBuilder.info("HIGHLIGHT"===t.toUpperCase()?"Highlighting "+i:"No longer highlighting "+i+"}").into(this),this.settings.set("highlightnicks",n),this.applySettings()}},{key:"cmdTIMESTAMPFORMAT",value:function(e){if(0===e.length)v.MessageBuilder.info("Current format: "+this.settings.get("timestampformat")+" (the default is 'HH:mm', for more info: http://momentjs.com/docs/#/displaying/format/)").into(this);else{var t=e.slice(1,e.length);/^[a-z :.,-\\*]+$/i.test(t)?(v.MessageBuilder.info("New format: "+this.settings.get("timestampformat")).into(this),this.settings.set("timestampformat",t),this.applySettings()):v.MessageBuilder.error("Invalid format, see: http://momentjs.com/docs/#/displaying/format/").into(this)}}},{key:"cmdBROADCAST",value:function(e){this.source.send("BROADCAST",{data:e.join(" ")})}},{key:"cmdWHISPER",value:function(e){if(e[0]&&U.test(e[0]))if(e[0].toLowerCase()===this.user.username.toLowerCase())v.MessageBuilder.error("Cannot send a message to yourself").into(this);else{var t=e.slice(1,e.length).join(" ");this.source.send("PRIVMSG",{nick:e[0],data:t})}else v.MessageBuilder.error("Invalid nick - /msg nick message").into(this)}},{key:"cmdCONNECT",value:function(e){this.reconnect=!1,this.uri=e[0],this.source.disconnect(),this.source.connect(this.uri)}},{key:"cmdSTALK",value:function(t){var n=this;if(t[0]&&/^\d+$/.test(t[0])&&(t[1]=t[0],t[0]=this.user.username),!t[0]||!U.test(t[0].toLowerCase()))return void v.MessageBuilder.error("Invalid nick - /stalk <nick> <limit>").into(this);if(this.busystalk)return void v.MessageBuilder.error("Still busy stalking").into(this);if(this.nextallowedstalk&&this.nextallowedstalk.isAfter(new Date))return void v.MessageBuilder.error("Next allowed stalk "+this.nextallowedstalk.fromNow()).into(this);this.busystalk=!0;var i=t[1]?parseInt(t[1]):3;v.MessageBuilder.info("Getting messages for "+[t[0]]+" ...").into(this),e.ajax({timeout:5e3,url:"/api/chat/stalk?username="+encodeURIComponent(t[0])+"&limit="+i}).always(function(){n.nextallowedstalk=(0,d.default)().add(10,"seconds"),n.busystalk=!1}).done(function(e){if(0===e.lines.length)v.MessageBuilder.info("No messages for "+t[0]).into(n);else{var i=d.default.utc(1e3*e.lines[e.lines.length-1].timestamp).local().format("MMMM Do YYYY, h:mm:ss a");v.MessageBuilder.info("Stalked "+t[0]+" last seen "+i).into(n),e.lines.forEach(function(t){return v.MessageBuilder.historical(t.text,new p.default({nick:e.nick}),1e3*t.timestamp).into(n)}),v.MessageBuilder.info("End of stalk (https://dgg.overrustlelogs.net/"+t[0]+")").into(n)}}).fail(function(e){return v.MessageBuilder.error("No messages for "+t[0]+" received. Try again later").into(n)})}},{key:"cmdMENTIONS",value:function(t){var n=this;if(t[0]&&/^\d+$/.test(t[0])&&(t[1]=t[0],t[0]=this.user.username),t[0]||(t[0]=this.user.username),!t[0]||!U.test(t[0].toLowerCase()))return void v.MessageBuilder.error("Invalid nick - /mentions <nick> <limit>").into(this);if(this.busymentions)return void v.MessageBuilder.error("Still busy getting mentions").into(this);if(this.nextallowedmentions&&this.nextallowedmentions.isAfter(new Date))return void v.MessageBuilder.error("Next allowed mentions "+this.nextallowedmentions.fromNow()).into(this);this.busymentions=!0;var i=t[1]?parseInt(t[1]):3;v.MessageBuilder.info("Getting mentions for "+[t[0]]+" ...").into(this),e.ajax({timeout:5e3,url:"/api/chat/mentions?username="+encodeURIComponent(t[0])+"&limit="+i}).always(function(){n.nextallowedmentions=(0,d.default)().add(10,"seconds"),n.busymentions=!1}).done(function(e){if(0===e.length)v.MessageBuilder.info("No mentions for "+t[0]).into(n);else{var i=d.default.utc(1e3*e[e.length-1].date).local().format("MMMM Do YYYY, h:mm:ss a");v.MessageBuilder.info("Mentions for "+t[0]+" last seen "+i).into(n),e.forEach(function(e){return v.MessageBuilder.historical(e.text,new p.default({nick:e.nick}),1e3*e.date).into(n)}),v.MessageBuilder.info("End of stalk (https://dgg.overrustlelogs.net/"+t[0]+")").into(n)}}).fail(function(e){return v.MessageBuilder.error("No mentions for "+t[0]+" received. Try again later").into(n)})}},{key:"cmdTAG",value:function(e){var n=this;if(0===e.length)return void(this.taggednicks.size>0?v.MessageBuilder.info("Tagged nicks: "+[].concat(s(this.taggednicks.keys())).join(",")+". Available colors: "+P.join(",")).into(this):v.MessageBuilder.info("No tagged nicks. Available colors: "+P.join(",")).into(this));var i=e.filter(function(e){return null!==e&&""!==e&&U.test(e)});if(0===i.length)return void v.MessageBuilder.error("Invalid nick - /tag <nick> <color>").into(this);i.forEach(function(i){var s=i.toLowerCase();if(s===n.user.username.toLowerCase())return void v.MessageBuilder.error("Cannot tag yourself").into(n);var o=e[1]&&-1!==P.indexOf(e[1])?e[1]:P[Math.floor(Math.random()*P.length)];n.mainwindow.getlines('.msg-user[data-username="'+s+'"]').removeClass(t.removeClasses("msg-tagged")).addClass("msg-tagged msg-tagged-"+o),n.taggednicks.set(s,o),v.MessageBuilder.info("Tagged "+i+" as "+o).into(n)}),this.settings.set("taggednicks",[].concat(s(this.taggednicks))),this.applySettings()}},{key:"cmdUNTAG",value:function(e){var n=this;if(0===e.length)return void(this.taggednicks.size>0?v.MessageBuilder.info("Tagged nicks: "+[].concat(s(this.taggednicks.keys())).join(",")+". Available colors: "+P.join(",")).into(this):v.MessageBuilder.info("No tagged nicks. Available colors: "+P.join(",")).into(this));var i=e.filter(function(e){return null!==e&&""!==e&&U.test(e)});if(0===i.length)return void v.MessageBuilder.error("Invalid nick - /untag <nick>").into(this);i.forEach(function(e){var i=e.toLowerCase();n.taggednicks.delete(i),n.mainwindow.getlines('.msg-chat[data-username="'+i+'"]').removeClass(t.removeClasses("msg-tagged"))}),v.MessageBuilder.info("Un-tagged "+i.join(",")).into(this),this.settings.set("taggednicks",[].concat(s(this.taggednicks))),this.applySettings()}},{key:"cmdBANINFO",value:function(){var t=this;v.MessageBuilder.info("Loading ban info ...").into(this),e.ajax({url:"/api/chat/me/ban"}).done(function(n){if("bannotfound"===n)return void v.MessageBuilder.info("You have no active bans. Thank you.").into(t);var i=e.extend({},K,n),s=i.username?i.username:"Chat",o=(0,d.default)(i.starttimestamp).format("MMMM Do YYYY, h:mm:ss a");if(i.endtimestamp){var r=(0,d.default)(i.endtimestamp).calendar();v.MessageBuilder.info("Temporary ban by "+s+" starting "+o+" and ending "+r).into(t)}else v.MessageBuilder.info("Permanent ban by "+s+" starting "+o+".").into(t);if(i.reason){var u=v.MessageBuilder.message(i.reason,new p.default({nick:i.username},i.starttimestamp));u.historical=!0,u.into(t)}v.MessageBuilder.info("End of ban information").into(t)}).fail(function(e){return v.MessageBuilder.error("Error loading ban info. Check your profile.").into(t)})}}],[{key:"extractTextOnly",value:function(e){return("/me "===e.toLowerCase().substring(0,4)?e.substring(4):e).trim()}},{key:"extractNicks",value:function(e){for(var t=void 0,n=new Set;t=k.exec(e);)n.add(t[1]);return[].concat(s(n))}},{key:"removeClasses",value:function(e){return function(t,n){return(n.match(new RegExp("\\b"+e+"(?:[A-z-]+)?\\b","g"))||[]).join(" ")}}},{key:"isArraysEqual",value:function(e,t){return(!e||!t)&&(e.length!==t.length||e.sort().toString()!==t.sort().toString())}},{key:"showNotification",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("granted"===Notification.permission){var s=new Notification(e,{body:t,tag:"dgg"+n,icon:"/notifyicon.png",dir:"auto"});s.onclick=function(){},i&&setTimeout(function(){return s.close()},8e3)}}},{key:"makeSafeForRegex",value:function(e){return e.trim().replace(/[\-\[\]\/{}()*+?.\\\^$|]/g,"\\$&")}},{key:"parseTimeInterval",value:function(e){var t=0,n={s:1e9,sec:1e9,secs:1e9,second:1e9,seconds:1e9,m:6e10,min:6e10,mins:6e10,minute:6e10,minutes:6e10,h:36e11,hr:36e11,hrs:36e11,hour:36e11,hours:36e11,d:864e11,day:864e11,days:864e11};return e.replace(/(\d+(?:\.\d*)?)([a-z]+)?/gi,function(e,i,s){i*=s?n[s.toLowerCase()]||n.s:n.s,t+=+i}),t}}]),t}();t.default=j}).call(t,n(3))},64:function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){var n="/me "===t.message.substring(0,4).toLowerCase()?t.message.substring(4):t.message;return C.forEach(function(i){return n=i.format(e,n,t)}),'<span class="text">'+n+"</span>"}function l(e){var t=[].concat(u(e.features||[])).filter(function(e){return!A.default.SUBSCRIBER.equals(e)}).sort(function(e,t){var n=void 0,i=void 0;return n=A.default.SUBSCRIBERT4.equals(e),i=A.default.SUBSCRIBERT4.equals(t),n>i?-1:n<i?1:(n=A.default.SUBSCRIBERT3.equals(e),i=A.default.SUBSCRIBERT3.equals(t),n>i?-1:n<i?1:(n=A.default.SUBSCRIBERT2.equals(e),i=A.default.SUBSCRIBERT2.equals(t),n>i?-1:n<i?1:(n=A.default.SUBSCRIBERT1.equals(e),i=A.default.SUBSCRIBERT1.equals(t),n>i?-1:n<i?1:(n=A.default.SUBSCRIBERT0.equals(e),i=A.default.SUBSCRIBERT0.equals(t),n>i?-1:n<i?1:(n=A.default.BOT2.equals(e)||A.default.BOT.equals(e),i=A.default.BOT2.equals(e)||A.default.BOT.equals(t),n>i?-1:n<i?1:(n=A.default.VIP.equals(e),i=A.default.VIP.equals(t),n>i?-1:n<i?1:(n=A.default.CONTRIBUTOR.equals(e)||A.default.TRUSTED.equals(e),i=A.default.CONTRIBUTOR.equals(t)||A.default.TRUSTED.equals(t),n>i?-1:n<i?1:(n=A.default.NOTABLE.equals(e),i=A.default.NOTABLE.equals(t),n>i?-1:n<i?1:e>t?-1:e<t?1:0))))))))}).map(function(e){var t=A.default.valueOf(e);return'<i class="flair icon-'+e.toLowerCase()+'" title="'+(null!==t?t.label:e)+'" />'}).join("");return t.length>0?'<span class="features">'+t+"</span>":""}function c(e){return"<i class='count'>"+e+'</i> <i class="x">X</i> <i class="hit">Hits</i> <i class=\'combo\'>C-C-C-COMBO</i>'}function h(e){return'<time class="time" title="'+e.timestamp.format(v.datetimeformat)+'">'+e.timestamp.format(e.timeformat)+"</time>"}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTypes=t.ChatEmoteMessage=t.ChatUserMessage=t.ChatMessage=t.ChatUIMessage=t.MessageGlobals=t.MessageBuilder=void 0;var d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=n(91),g=n(28),A=i(g),E=n(0),m=i(E),p={STATUS:"STATUS",ERROR:"ERROR",INFO:"INFO",COMMAND:"COMMAND",BROADCAST:"BROADCAST",UI:"UI",CHAT:"CHAT",USER:"USER",EMOTE:"EMOTE"},v={timeformat:"HH:mm",datetimeformat:"MMMM Do YYYY, h:mm:ss a"},C=[];C.push(new f.HtmlTextFormatter),C.push(new f.UrlFormatter),C.push(new f.EmoteFormatter),C.push(new f.MentionedUserFormatter),C.push(new f.GreenTextFormatter);var S=function(){function e(){r(this,e)}return d(e,null,[{key:"element",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new T(e,t)}},{key:"status",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O(e,t,p.STATUS)}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O(e,t,p.ERROR)}},{key:"info",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O(e,t,p.INFO)}},{key:"broadcast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O(e,t,p.BROADCAST)}},{key:"command",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O(e,t,p.COMMAND)}},{key:"message",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new I(e,t,n)}},{key:"emote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return new R(e,t,n)}},{key:"whisper",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=new I(e,t,i);return o.id=s,o.target=n,o}},{key:"historical",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new I(e,t,n);return i.historical=!0,i}}]),e}(),T=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];r(this,t),this.type=p.UI,this.message=e,this.classes=n}return d(t,[{key:"into",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.addMessage(this,t),this}},{key:"wrap",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.push(this.classes),n.unshift("msg-"+this.type.toLowerCase()),n.unshift("msg-chat"),i.class=n.join(" "),e("<div />",i).html(t)[0].outerHTML}},{key:"html",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.wrap(this.message)}}]),t}(),O=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.CHAT;r(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.user=null,o.type=i,o.continued=!1,o.timestamp=n?m.default.utc(n).local():(0,m.default)(),o.timeformat=v.timeformat,o}return o(t,e),d(t,[{key:"html",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=[],n={};return this.continued&&t.push("msg-continue"),this.wrap(h(this)+" "+a(e,this),t,n)}}]),t}(T),I=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,p.USER));return o.user=n,o.id=null,o.isown=!1,o.highlighted=!1,o.historical=!1,o.target=null,o.tag=null,o.slashme=!1,o.mentioned=[],o}return o(t,e),d(t,[{key:"html",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=[],n={};this.id&&(n["data-id"]=this.id),this.user&&this.user.username&&(n["data-username"]=this.user.username.toLowerCase()),this.mentioned&&this.mentioned.length>0&&(n["data-mentioned"]=this.mentioned.join(" ").toLowerCase()),this.isown&&t.push("msg-own"),this.slashme&&t.push("msg-emote"),this.historical&&t.push("msg-historical"),this.highlighted&&t.push("msg-highlight"),this.continued&&!this.target&&t.push("msg-continue"),this.tag&&t.push("msg-tagged msg-tagged-"+this.tag),this.target&&t.push("msg-whisper");var i=": ";this.target?i=' whispered you ... <span><a class="chat-open-whisper"><i class="fa fa-envelope"></i> open</a> <a class="chat-remove-whisper"><i class="fa fa-times" ></i> remove</a></span>':this.slashme?i="":this.continued&&(i="");var s=l(this.user)+' <a class="user '+this.user.features.join(" ")+'">'+this.user.username+"</a>";return this.wrap(h(this)+" "+s+'<span class="ctrl">'+i+"</span> "+a(e,this),t,n)}}]),t}(O),R=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;r(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,p.EMOTE));return o.emotecount=i,o.emotecountui=null,o}return o(t,e),d(t,[{key:"html",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.wrap(h(this)+" "+a(e,this)+' <span class="chat-combo">'+c(this.emotecount)+"<span>")}},{key:"incEmoteCount",value:function(){++this.emotecount;var e="";this.emotecount>=50?e=" x50":this.emotecount>=30?e=" x30":this.emotecount>=20?e=" x20":this.emotecount>=10?e=" x10":this.emotecount>=5&&(e=" x5"),this.emotecountui||(this.emotecountui=this.ui.find(".chat-combo")),this.emotecountui.detach().attr("class","chat-combo"+e).html(c(this.emotecount)).appendTo(this.ui)}},{key:"completeCombo",value:function(){this.emotecountui||(this.emotecountui=this.ui.find(".chat-combo")),this.emotecountui.addClass("combo-complete")}}]),t}(O);t.MessageBuilder=S,t.MessageGlobals=v,t.ChatUIMessage=T,t.ChatMessage=O,t.ChatUserMessage=I,t.ChatEmoteMessage=R,t.MessageTypes=p}).call(t,n(3))},65:function(e,t,n){"use strict";(function(e){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();n(136);var o=function(){function t(n,s){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{sliderMinHeight:40,tabIndex:1};i(this,t);var u=e(s);u.find(".chat-scroll-notify").length>0&&(u.on("update",function(){return u.toggleClass("chat-unpinned",!o.isPinned())}),u.on("mousedown",".chat-scroll-notify",function(){return!1}),u.on("mouseup",".chat-scroll-notify",function(){return o.updateAndPin(!0),!1})),this.scroller=u.nanoScroller(Object.assign({disableResize:!0,preventPageScrolling:!0},r))[0].nanoscroller}return s(t,[{key:"isPinned",value:function(){return!this.scroller.isActive||this.scroller.contentScrollTop>=this.scroller.maxScrollTop-30}},{key:"updateAndPin",value:function(e){this.reset(),e&&this.scroller.scrollBottom(0)}},{key:"reset",value:function(){this.scroller.reset()}},{key:"destroy",value:function(){this.scroller.destroy()}}]),t}();t.default=o}).call(t,n(3))},66:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.nick=t.nick||"",this.username=t.nick||"",this.features=t.features||[]}return s(e,[{key:"hasAnyFeatures",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=!0,s=!1,o=void 0;try{for(var r,u=t[Symbol.iterator]();!(i=(r=u.next()).done);i=!0){var a=r.value;if(-1!==this.features.indexOf("string"!=typeof a?a.toString():a))return!0}}catch(e){s=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw o}}return!1}},{key:"hasFeature",value:function(e){return this.hasAnyFeatures(e)}}]),e}();t.default=o},67:function(e,t,n){"use strict";(function(e){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(65),r=function(e){return e&&e.__esModule?e:{default:e}}(o),u=["green","yellow","orange","purple","blue","sky","lime","pink"],a=function(){function t(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i(this,t),this.name=n,this.label=o,this.maxlines=0,this.linecount=0,this.locks=0,this.waspinned=!0,this.scrollplugin=null,this.visible=!1,this.tag=null,this.ui=e('<div id="chat-win-'+n+'" class="chat-output '+s+' nano" style="display: none;">                        <div class="chat-lines nano-content"></div>                        <div class="chat-scroll-notify">More messages below</div>                     </div>'),this.lines=this.ui.find(".chat-lines")}return s(t,[{key:"destroy",value:function(){return this.ui.remove(),this.scrollplugin.destroy(),this}},{key:"into",value:function(e){return this.maxlines=e.settings.get("maxlines"),this.scrollplugin=new r.default(e,this.ui),this.tag=e.taggednicks.get(this.name)||u[Math.floor(Math.random()*u.length)],e.output.append(this.ui),e.addWindow(this.name.toLowerCase(),this),e.windowToFront(this.name.toLowerCase()),this}},{key:"show",value:function(){this.visible||(this.visible=!0,this.ui.show())}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this.ui.hide())}},{key:"addline",value:function(e){this.lines.append(e),this.linecount++}},{key:"getlines",value:function(e){return this.lines.children(e)}},{key:"removelines",value:function(e){var t=this.lines.children(e);this.linecount-=t.length,t.remove()}},{key:"locked",value:function(){return this.locks>0}},{key:"lock",value:function(){1===++this.locks&&(this.waspinned=this.scrollplugin.isPinned())}},{key:"unlock",value:function(){0===--this.locks&&this.scrollplugin.updateAndPin(this.waspinned)}},{key:"cleanup",value:function(){if(this.scrollplugin.isPinned()||this.waspinned){var e=this.lines.children();if(e.length>=this.maxlines){var t=e.slice(0,e.length-this.maxlines);this.linecount-=t.length,t.remove()}}}},{key:"updateAndPin",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scrollplugin.updateAndPin(e)}}]),t}();t.default=a}).call(t,n(3))},71:function(e,t,n){var i=n(118);e.exports=function(e,t,n){function s(){var c=i()-a;c<t&&c>0?o=setTimeout(s,t-c):(o=null,n||(l=e.apply(u,r),o||(u=r=null)))}var o,r,u,a,l;return null==t&&(t=100),function(){u=this,r=arguments,a=i();var c=n&&!o;return o||(o=setTimeout(s,t)),c&&(l=e.apply(u,r),u=r=null),l}}},74:function(e,t){},78:function(e,t){e.exports={destiny:["Dravewin","INFESTINY","FIDGETLOL","Hhhehhehe","GameOfThrows","WORTH","FeedNathan","Abathur","LUL","Heimerdonger","SoSad","DURRSTINY","SURPRISE","NoTears","OverRustle","DuckerZ","Kappa","Klappa","DappaKappa","BibleThump","AngelThump","FrankerZ","BasedGod","OhKrappa","SoDoge","WhoahDude","MotherFuckinGame","DaFeels","UWOTM8","CallCatz","CallChad","DatGeoff","Disgustiny","FerretLOL","Sippy","DestiSenpaii","Nappa","DAFUK","AYYYLMAO","DANKMEMES","MLADY","SOTRIGGERED","MASTERB8","NOTMYTEMPO","LIES","LeRuse","YEE","SWEATSTINY","PEPE","CheekerZ","SpookerZ","SLEEPSTINY","PICNIC","Memegasm","WEEWOO","KappaRoss","ASLAN","DJAslan","TRUMPED","BASEDWATM8","BERN","HmmStiny","PepoThink","FeelsAmazingMan","FeelsBadMan","FeelsGoodMan","OhMyDog","Wowee","haHAA","POTATO","NOBULLY","ChibiDesti","gachiGASM"],twitch:["nathanD","nathanDank","nathanF","nathanNotears","nathanPepe","nathanRustle","nathanTowel","nathanWat","nathanThinking","nathanRuse","nathanYee","nathanWeeb"]}},89:function(e,t,n){"use strict";(function(e){function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return(e.match(/[\S]/)[0]||"_").toLowerCase()}function r(e,t){return e&&t?e.promoted!==t.promoted?e.promoted>t.promoted?-1:1:e.isemote!==t.isemote?e.isemote&&!t.isemote?-1:1:e.weight!==t.weight?e.weight>t.weight?-1:1:(e=e.data.toLowerCase(),t=t.data.toLowerCase(),e===t?0:e>t?1:-1):0}function u(e,t){var n=e.substring(0,t),i=e.substring(t),s=n.lastIndexOf(" ")+1,o=i.indexOf(" "),r=!1;return s>0&&(n=n.substring(s)),o>-1&&(i=i.substring(0,o)),0===n.lastIndexOf("@")&&(s++,n=n.substring(1),r=!0),{word:n+i,pre:n,post:i,startCaret:s,isUserSearch:r,orig:e}}function a(e){e.reset(),e.redrawHelpers()}function l(e){g&&clearTimeout(g),g=setTimeout(a,15e3,e)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=n(53),d=function(e){return e&&e.__esModule?e:{default:e}}(h),f=n(27),g=void 0,A=function(){function t(){s(this,t),this.minWordLength=1,this.maxResults=20,this.buckets=new Map,this.searchResults=[],this.searchCriteria=null,this.selectedIndex=-1,this.input=null,this.timeout=null,this.ui=e('<div id="chat-auto-complete"></div>'),this.container=null}return c(t,[{key:"redrawHelpers",value:function(){var t=this.searchResults.map(function(e,t){return'<li data-index="'+t+'">'+e.data+"</li>"});t.length>0&&(this.container=e("<ul>"+t.join("")+"</ul>"),this.ui.detach().empty().append(this.container).insertBefore(this.input),this.updateHelpers(),l(this)),this.chat.ui.toggleClass("chat-autocomplete-in",t.length>0),this.ui.toggleClass("active",t.length>0)}},{key:"updateHelpers",value:function(){var t=this;this.ui.find("li.active").removeClass("active"),this.ui.find('li[data-index="'+this.selectedIndex+'"]').addClass("active");var n=this.container.position().left,i=this.ui.width(),s=this.ui.find("li").get();this.ui.find("li.active").length>0&&(e(s[this.selectedIndex+3]).each(function(s,o){var r=e(o).position().left+n+e(o).outerWidth();r>i&&t.container.css("left",n+i-r)}),e(s[Math.max(0,this.selectedIndex-2)]).each(function(i,s){e(s).position().left+n<0&&t.container.css("left",e(s).position().left)})),l(this)}},{key:"bind",value:function(e){var t=this;this.chat=e,this.input=e.input,this.input.on("mouseup",function(){var e=t.input[0].selectionStart;if(e!==t.input[0].selectionEnd)t.reset(),t.redrawHelpers();else{var n=t.input.val().toString();t.search(n,e)}});var n="";this.input.on("keydown",function(e){switch(n=t.input.val().toString(),(0,f.getKeyCode)(e)){case f.KEYCODES.TAB:t.searchResults.length>0&&(t.selectResult(t.selectedIndex>=t.searchResults.length-1?0:t.selectedIndex+1),t.updateHelpers()),e.preventDefault(),e.stopPropagation()}}),this.input.on("keypress",function(e){var n=String.fromCharCode((0,f.getKeyCode)(e))||"";switch((0,f.getKeyCode)(e)){case f.KEYCODES.ENTER:case f.KEYCODES.TAB:break;default:if(n.length>0){t.promoteIfSelected();var i=t.input.val().toString(),s=t.input[0].selectionStart,o=i.substring(0,s),r=i.substring(s),u=o+n+r;t.search(u,s)}}}),this.input.on("keyup",function(e){var i=t.input.val().toString();switch((0,f.getKeyCode)(e)){case f.KEYCODES.TAB:break;case f.KEYCODES.ENTER:t.reset(),t.redrawHelpers();break;default:if(i!==n){var s=t.input[0].selectionStart;t.search(i,s)}""===i&&(t.reset(),t.redrawHelpers())}n=""}),this.ui.on("click","li",function(e){t.selectResult(parseInt(e.currentTarget.getAttribute("data-index"))),t.redrawHelpers()}),setInterval(this.expireUsers.bind(this),6e4)}},{key:"search",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.reset();var i=u(e,t);n&&(i.isUserSearch=!0),this.searchCriteria=i,this.searchResults=this.find(i),this.redrawHelpers()}},{key:"reset",value:function(){this.searchCriteria=null,this.searchResults=[],this.selectedIndex=-1}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=o(e),r=this.buckets.get(s)||new Map,u=r.get(e)||{data:e,weight:n,isemote:t,promoted:i};return r.set(e,u),this.buckets.set(s,r),u}},{key:"remove",value:function(e){var t=o(e),n=this.buckets.get(t);return!(!n||!n.has(e))&&(n.delete(e),!0)}},{key:"weight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.add(e,!1,t,n).weight=t}},{key:"find",value:function(e){if(e.word.length>=this.minWordLength){var t=o(e.word),n=this.buckets.get(t)||new Map,s=new RegExp("^"+d.default.makeSafeForRegex(e.pre),"i");return[].concat(i(n.values())).filter(function(t){return t.data.toLowerCase()!==e.word.toLowerCase()}).filter(function(t){return(!e.isUserSearch||!t.isemote)&&s.test(t.data)}).sort(r).slice(0,this.maxResults)}return[]}},{key:"selectResult",value:function(e){this.selectedIndex=Math.min(e,this.searchResults.length-1);var t=this.searchResults[this.selectedIndex];if(t){var n=this.searchCriteria.orig.substr(0,this.searchCriteria.startCaret),i=this.searchCriteria.orig.substr(this.searchCriteria.startCaret+this.searchCriteria.word.length);" "===i[0]&&0!==i.length||(i=" "+i),this.input.focus().val(n+t.data+i),this.input[0].setSelectionRange(n.length+t.data.length+1,n.length+t.data.length+1),this.selectedIndex=e}}},{key:"promoteIfSelected",value:function(){if(this.selectedIndex>=0){var e=this.searchResults[this.selectedIndex];if(e&&(e.promoted=Date.now(),e.isemote)){var t=this.buckets.get(o(e.data))||new Map;[].concat(i(t.values())).filter(function(e){return!e.isemote}).forEach(function(e){return e.promoted=0})}}}},{key:"expireUsers",value:function(){var e=Date.now()-6e5;this.buckets.forEach(function(t){[].concat(i(t.values())).filter(function(e){return!e.isemote}).forEach(function(t){t.promoted<=e&&(t.promoted=0),t.weight<=e&&(t.weight=1)})})}}]),t}();t.default=A}).call(t,n(3))},90:function(e,t,n){"use strict";(function(e){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function t(e,i){var s=this;n(this,t),this.chat=e,this.css=i,this.focused=[],this.chat.output.on("mousedown",function(e){return s.toggleElement(e.target)})}return i(t,[{key:"toggleElement",value:function(t){var n=e(t);n.hasClass("chat-user")?(this.chat.settings.get("focusmentioned")||this.toggleFocus(n.closest(".msg-user").data("username"),!0),this.toggleFocus(n.text())):n.hasClass("user")?this.toggleFocus(n.text()):this.focused.length>0&&this.clearFocus()}},{key:"toggleFocus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=(e||"").toLowerCase();var n=this.focused.indexOf(e.toLowerCase()),i=-1!==n;return null===t&&(t=!i),t&&!i?this.addCssRule(e):!t&&i&&this.removeCssRule(n),this}},{key:"addCssRule",value:function(e){var t=void 0;t=this.chat.settings.get("focusmentioned")?'.msg-user[data-username="'+e+'"],.msg-user[data-mentioned~="'+e+'"]{opacity:1 !important;}':'.msg-user[data-username="'+e+'"]{opacity:1 !important;}',this.css.insertRule(t,this.focused.length),this.focused.push(e),this.redraw()}},{key:"removeCssRule",value:function(e){this.css.deleteRule(e),this.focused.splice(e,1),this.redraw()}},{key:"clearFocus",value:function(){var e=this;this.focused.forEach(function(t){return e.css.deleteRule(0)}),this.focused=[],this.redraw()}},{key:"redraw",value:function(){this.chat.ui.toggleClass("focus-user",this.focused.length>0)}}]),t}();t.default=s}).call(t,n(3))},91:function(e,t,n){"use strict";(function(e){function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.UrlFormatter=t.MentionedUserFormatter=t.HtmlTextFormatter=t.GreenTextFormatter=t.EmoteFormatter=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(28),u=function(e){return e&&e.__esModule?e:{default:e}}(r),a=n(135),l="(?:"+a.join("|")+")",c=document.createElement("div"),h=void 0,d=void 0,f=function(){function e(){s(this,e)}return o(e,[{key:"format",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return c.textContent=t,c.innerHTML}}]),e}(),g=function(){function e(){s(this,e)}return o(e,[{key:"format",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!h||!d){var s=[].concat(i(e.emoticons)).join("|"),o=[].concat(i(e.twitchemotes)).join("|");h=new RegExp("(^|\\s)("+s+")(?=$|\\s)","gm"),d=new RegExp("(^|\\s)("+s+"|"+o+")(?=$|\\s)","gm")}var r=n.user&&n.user.hasFeature(u.default.SUBSCRIBERT0)||!n.user?d:h;return t.replace(r,'$1<div title="$2" class="chat-emote chat-emote-$2">$2 </div>')}}]),e}(),A=function(){function e(){s(this,e)}return o(e,[{key:"format",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.user&&0===t.indexOf("&gt;")&&n.user.hasAnyFeatures(u.default.SUBSCRIBER,u.default.SUBSCRIBERT0,u.default.SUBSCRIBERT1,u.default.SUBSCRIBERT2,u.default.SUBSCRIBERT3,u.default.SUBSCRIBERT4,u.default.NOTABLE,u.default.TRUSTED,u.default.CONTRIBUTOR,u.default.COMPCHALLENGE,u.default.ADMIN,u.default.MODERATOR)&&(t='<span class="greentext">'+t+"</span>"),t}}]),e}(),E=function(){function e(){s(this,e)}return o(e,[{key:"format",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n&&n.mentioned&&n.mentioned.length>0?t.replace(new RegExp("((?:^|\\s)@?)("+n.mentioned.join("|")+")(?=$|\\s|[.?!,])","igm"),'$1<span class="chat-user">$2</span>'):t}}]),e}(),m=function(){function t(){s(this,t);var n={"p{L}":"\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC","p{N}":"\\u0030-\\u0039\\u00B2\\u00B3\\u00B9\\u00BC-\\u00BE\\u0660-\\u0669\\u06F0-\\u06F9\\u07C0-\\u07C9\\u0966-\\u096F\\u09E6-\\u09EF\\u09F4-\\u09F9\\u0A66-\\u0A6F\\u0AE6-\\u0AEF\\u0B66-\\u0B6F\\u0B72-\\u0B77\\u0BE6-\\u0BF2\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0CE6-\\u0CEF\\u0D66-\\u0D75\\u0E50-\\u0E59\\u0ED0-\\u0ED9\\u0F20-\\u0F33\\u1040-\\u1049\\u1090-\\u1099\\u1369-\\u137C\\u16EE-\\u16F0\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1946-\\u194F\\u19D0-\\u19DA\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1B50-\\u1B59\\u1BB0-\\u1BB9\\u1C40-\\u1C49\\u1C50-\\u1C59\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u2150-\\u2182\\u2185-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2CFD\\u3007\\u3021-\\u3029\\u3038-\\u303A\\u3192-\\u3195\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\uA620-\\uA629\\uA6E6-\\uA6EF\\uA830-\\uA835\\uA8D0-\\uA8D9\\uA900-\\uA909\\uA9D0-\\uA9D9\\uAA50-\\uAA59\\uABF0-\\uABF9\\uFF10-\\uFF19","p{Sc}":"\\u0024\\u00A2-\\u00A5\\u058F\\u060B\\u09F2\\u09F3\\u09FB\\u0AF1\\u0BF9\\u0E3F\\u17DB\\u20A0-\\u20B9\\uA838\\uFDFC\\uFE69\\uFF04\\uFFE0\\uFFE1\\uFFE5\\uFFE6","p{Sk}":"\\u005E\\u0060\\u00A8\\u00AF\\u00B4\\u00B8\\u02C2-\\u02C5\\u02D2-\\u02DF\\u02E5-\\u02EB\\u02ED\\u02EF-\\u02FF\\u0375\\u0384\\u0385\\u1FBD\\u1FBF-\\u1FC1\\u1FCD-\\u1FCF\\u1FDD-\\u1FDF\\u1FED-\\u1FEF\\u1FFD\\u1FFE\\u309B\\u309C\\uA700-\\uA716\\uA720\\uA721\\uA789\\uA78A\\uFBB2-\\uFBC1\\uFF3E\\uFF40\\uFFE3","p{So}":"\\u00A6\\u00A9\\u00AE\\u00B0\\u0482\\u060E\\u060F\\u06DE\\u06E9\\u06FD\\u06FE\\u07F6\\u09FA\\u0B70\\u0BF3-\\u0BF8\\u0BFA\\u0C7F\\u0D79\\u0F01-\\u0F03\\u0F13\\u0F15-\\u0F17\\u0F1A-\\u0F1F\\u0F34\\u0F36\\u0F38\\u0FBE-\\u0FC5\\u0FC7-\\u0FCC\\u0FCE\\u0FCF\\u0FD5-\\u0FD8\\u109E\\u109F\\u1390-\\u1399\\u1940\\u19DE-\\u19FF\\u1B61-\\u1B6A\\u1B74-\\u1B7C\\u2100\\u2101\\u2103-\\u2106\\u2108\\u2109\\u2114\\u2116\\u2117\\u211E-\\u2123\\u2125\\u2127\\u2129\\u212E\\u213A\\u213B\\u214A\\u214C\\u214D\\u214F\\u2195-\\u2199\\u219C-\\u219F\\u21A1\\u21A2\\u21A4\\u21A5\\u21A7-\\u21AD\\u21AF-\\u21CD\\u21D0\\u21D1\\u21D3\\u21D5-\\u21F3\\u2300-\\u2307\\u230C-\\u231F\\u2322-\\u2328\\u232B-\\u237B\\u237D-\\u239A\\u23B4-\\u23DB\\u23E2-\\u23F3\\u2400-\\u2426\\u2440-\\u244A\\u249C-\\u24E9\\u2500-\\u25B6\\u25B8-\\u25C0\\u25C2-\\u25F7\\u2600-\\u266E\\u2670-\\u26FF\\u2701-\\u2767\\u2794-\\u27BF\\u2800-\\u28FF\\u2B00-\\u2B2F\\u2B45\\u2B46\\u2B50-\\u2B59\\u2CE5-\\u2CEA\\u2E80-\\u2E99\\u2E9B-\\u2EF3\\u2F00-\\u2FD5\\u2FF0-\\u2FFB\\u3004\\u3012\\u3013\\u3020\\u3036\\u3037\\u303E\\u303F\\u3190\\u3191\\u3196-\\u319F\\u31C0-\\u31E3\\u3200-\\u321E\\u322A-\\u3247\\u3250\\u3260-\\u327F\\u328A-\\u32B0\\u32C0-\\u32FE\\u3300-\\u33FF\\u4DC0-\\u4DFF\\uA490-\\uA4C6\\uA828-\\uA82B\\uA836\\uA837\\uA839\\uAA77-\\uAA79\\uFDFD\\uFFE4\\uFFE8\\uFFED\\uFFEE\\uFFFC\\uFFFD"},i=n["p{L}"],o=n["p{N}"],r=i+o,u=r+"/\\-+=_&~*%@|#.,:;'?!"+n["p{Sc}"]+n["p{Sk}"]+n["p{So}"],a=r+"/\\-+=_&~*%;"+n["p{Sc}"],c="(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])",h="["+r+"](?:["+r+"\\-]*["+r+"])?",d="(?:"+h+"\\.)+",f="(?:"+d+l+"|(?:\\b"+c+"\\."+c+"\\."+c+"\\."+c+"\\b))",g="\\[["+u+"]*(?:\\[["+u+"]*\\]["+u+"]*)*\\]",A="\\(["+u+"]*(?:\\(["+u+"]*\\)["+u+"]*)*\\)",E=A+"|"+g,m="(?:["+u+"]*(?:"+E+"|["+a+"])+)+",p="(?:"+m+"|/|\\b|$)",v="(?:"+f+"(?::[0-9]+)?/"+p+")|(?:"+f+"(?::[0-9]+)?(?:\\b|$))",C="\\b(https?|ftp|wss?)://"+m,S=C+"|"+v;this.linkregex=new RegExp(S,"gi"),this._elem=e("<div/>")}return o(t,[{key:"encodeUrl",value:function(e){return e.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/([^\#-~| |!])/g,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{key:"format",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){var n=this,i="";return/\b(?:NSFL)\b/i.test(t)?i="nsfl-link":/\b(?:NSFW|SPOILER)\b/i.test(t)&&(i="nsfw-link"),t.replace(n.linkregex,function(e,t){t=t?"":"http://";var s=n._elem.html(e).text(),o=s.match(n.linkregex);if(o){e=n.encodeUrl(o[0]);var r=n.encodeUrl(s.substring(o[0].length));return'<a target="_blank" class="externallink '+i+'" href="'+(t+e)+'" rel="nofollow">'+e+"</a>"+r}return e})}}}]),t}();t.EmoteFormatter=g,t.GreenTextFormatter=A,t.HtmlTextFormatter=f,t.MentionedUserFormatter=E,t.UrlFormatter=m}).call(t,n(3))},92:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(27),r=n(44),u=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){function e(t){var n=this;i(this,e),this.input=t.input,this.history=u.default.read("chat.history")||[],this.index=-1,this.lastinput="",this.maxentries=20,this.input.on("keydown",function(e){e.shiftKey||e.metaKey||e.ctrlKey||!(0,o.isKeyCode)(e,o.KEYCODES.UP)&&!(0,o.isKeyCode)(e,o.KEYCODES.DOWN)?n.index=-1:(n.show((0,o.isKeyCode)(e,o.KEYCODES.UP)?-1:1),e.preventDefault(),e.stopPropagation())})}return s(e,[{key:"show",value:function(e){if(this.index<0){if(-1!==e)return;if(this.index=this.history.length,this.lastinput=this.input.val().toString(),this.index<=0)return}var t=this.index+e,n=this.lastinput;t>=this.history.length||t<0?t>=this.history.length&&(this.index=-1):(this.index=t,n=this.history[t]),this.input.val(n)}},{key:"add",value:function(e){this.index=-1,this.history.length>0&&this.history[this.history.length-1]===e||(this.history.push(e),this.history.length>this.maxentries&&this.history.slice(-this.maxentries),u.default.write("chat.history",this.history))}}]),e}();t.default=a},93:function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return'<div class="emote"><span title="'+e+'" class="chat-emote chat-emote-'+e+'">'+e+"</span></div>"}function l(t){switch(t.getAttribute("type")){case"checkbox":var n=e(t).is(":checked");return Boolean(t.hasAttribute("data-opposite")?!n:n);case"text":return e(t).val()}}function c(t,n){switch(t.getAttribute("type")){case"checkbox":e(t).prop("checked",Boolean(t.hasAttribute("data-opposite")?!n:n));break;case"text":e(t).val(n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatWhisperUsers=t.ChatEmoteMenu=t.ChatUserMenu=t.ChatSettingsMenu=t.ChatMenu=void 0;var h=function e(t,n,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,n);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in s)return s.value;var r=s.get;if(void 0!==r)return r.call(i)},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=n(66),g=i(f),A=n(65),E=i(A),m=n(28),p=i(m),v=n(43),C=i(v),S=n(67),T=i(S),O=n(71),I=i(O),R=n(64),B=n(0),w=i(B),N=n(27),y=function(e){function t(e,n,i){o(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.ui=e,s.btn=n,s.chat=i,s.visible=!1,s.shown=!1,s.ui.find(".scrollable").get().forEach(function(e){return s.scrollplugin=new E.default(i,e)}),s.ui.on("click",".close,.menu-close",s.hide.bind(s)),s.btn.on("click",function(e){s.visible&&i.input.focus(),s.toggle(e)}),s}return u(t,e),d(t,[{key:"show",value:function(){this.visible||(this.visible=!0,this.shown=!0,this.btn.addClass("active"),this.ui.addClass("active"),this.redraw(),this.emit("show"))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this.btn.removeClass("active"),this.ui.removeClass("active"),this.emit("hide"))}},{key:"toggle",value:function(){var e=this.visible;t.closeMenus(this.chat),e||this.show()}},{key:"redraw",value:function(){this.visible&&this.scrollplugin&&this.scrollplugin.reset()}}],[{key:"closeMenus",value:function(e){e.menus.forEach(function(e){return e.hide()})}}]),t}(C.default),M=function(t){function n(e,t,i){o(this,n);var s=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,i));return s.notificationEl=s.ui.find("#chat-settings-notification-permissions"),s.ui.on("change",'input[type="checkbox"]',function(e){return s.onSettingsChange(e)}),s.ui.on("keypress blur",'textarea[name="customhighlight"]',function(e){return s.onCustomHighlightChange(e)}),s}return u(n,t),d(n,[{key:"onCustomHighlightChange",value:function(t){if((0,N.isKeyCode)(t,N.KEYCODES.ENTER)){var n=e(t.target).val().toString().split(",").map(function(e){return e.trim()});this.chat.settings.set("customhighlight",[].concat(s(new Set(n)))),this.chat.applySettings(!1),this.chat.commitSettings()}}},{key:"onSettingsChange",value:function(t){var n=this,i=l(t.target),s=t.target.getAttribute("name");if(void 0!==i){switch(s){case"profilesettings":!i&&this.chat.authenticated&&e.ajax({url:"/api/chat/me/settings",method:"delete"});break;case"notificationwhisper":case"notificationhighlight":i&&this.notificationPermission().then(function(){return n.updateNotification()})}this.chat.settings.set(s,i),this.chat.applySettings(!1),this.chat.commitSettings()}}},{key:"show",value:function(){var e=this;this.visible||(this.ui.find("input").get().filter(function(t){return e.chat.settings.has(t.getAttribute("name"))}).forEach(function(t){return c(t,e.chat.settings.get(t.getAttribute("name")))}),this.ui.find('textarea[name="customhighlight"]').val(this.chat.settings.get("customhighlight")||""),this.updateNotification()),h(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"show",this).call(this)}},{key:"updateNotification",value:function(){var e="default"===Notification.permission?"required":Notification.permission;this.notificationEl.text("(Permission "+e+")")}},{key:"notificationPermission",value:function(){return new Promise(function(e,t){switch(Notification.permission){case"default":Notification.requestPermission(function(n){switch(n){case"granted":e(n);break;default:t(n)}});break;case"granted":e(Notification.permission);break;case"denied":default:t(Notification.permission)}})}}]),n}(y),F=function(t){function n(t,i,s){o(this,n);var u=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,s));return u.searchterm="",u.searchcount=0,u.totalcount=0,u.header=u.ui.find("h5 span"),u.container=u.ui.find(".content:first"),u.searchinput=u.ui.find("#chat-user-list-search .form-control:first"),u.container.on("click",".user",function(e){return u.chat.userfocus.toggleFocus(e.target.getAttribute("data-username"))}),u.container.on("click",".whisper-nick",function(t){y.closeMenus(u.chat);var n=u.chat.input.val().toString().trim(),i=e(t.target).parent().data("username");return u.chat.input.val(n+(""===n?"":" ")+i+" ").focus(),!1}),u.chat.source.on("JOIN",function(e){return u.addAndRedraw(e.nick)}),u.chat.source.on("QUIT",function(e){return u.removeAndRedraw(e.nick)}),u.chat.source.on("NAMES",function(e){return u.addAll()}),u.searchinput.on("keyup",(0,I.default)(function(){u.searchterm=u.searchinput.val(),u.filter(),u.redraw()},100)),u}return u(n,t),d(n,[{key:"show",value:function(){h(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"show",this).call(this),this.searchinput.focus()}},{key:"redraw",value:function(){if(this.visible){var e=this.searchterm.length>0;e&&this.totalcount!==this.searchcount?this.header.text("Users ("+this.searchcount+" out of "+this.totalcount+")"):this.header.text("Users ("+this.totalcount+")"),this.ui.toggleClass("search-in",e)}h(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"redraw",this).call(this)}},{key:"addAll",value:function(){var e=this;this.totalcount=0,this.container.empty(),[].concat(s(this.chat.users.keys())).forEach(function(t){return e.addElement(t)}),this.sort(),this.filter(),this.redraw()}},{key:"addAndRedraw",value:function(e){this.hasElement(e)||(this.addElement(e),this.sort(),this.filter(),this.redraw())}},{key:"removeAndRedraw",value:function(e){this.hasElement(e)&&(this.removeElement(e),this.redraw())}},{key:"removeElement",value:function(e){this.container.find('.user[data-username="'+e+'"]').remove(),this.totalcount--}},{key:"addElement",value:function(e){var t=this.chat.users.get(e.toLowerCase()),n=t.username&&""!==t.username?t.username:"Anonymous",i=0===t.features.length?"nofeature":t.features.join(" ");this.container.append('<a data-username="'+t.username+'" class="user '+i+'">'+n+' <i class="fa fa-share-square whisper-nick" aria-hidden="true"></i></a>'),this.totalcount++}},{key:"hasElement",value:function(e){return this.container.find('.user[data-username="'+e+'"]').length>0}},{key:"filter",value:function(){var t=this;this.searchcount=0,this.searchterm&&this.searchterm.length>0?this.container.children(".user").get().forEach(function(n){var i=n.getAttribute("data-username").toLowerCase().indexOf(t.searchterm.toLowerCase())>=0;e(n).toggleClass("found",i),i&&t.searchcount++}):this.container.children(".user").removeClass("found")}},{key:"sort",value:function(){var e=this;this.container.children(".user").get().sort(function(t,n){var i=e.chat.users.get(t.getAttribute("data-username").toLowerCase()),s=e.chat.users.get(n.getAttribute("data-username").toLowerCase());if(!i||!s)return 0;var o=void 0,r=void 0;return o=i.hasFeature(p.default.ADMIN)||i.hasFeature(p.default.VIP),r=s.hasFeature(p.default.ADMIN)||s.hasFeature(p.default.VIP),o>r?-1:o<r?1:(o=i.hasFeature(p.default.BOT2),r=s.hasFeature(p.default.BOT2),o>r?1:o<r?-1:(o=i.hasFeature(p.default.BOT),r=s.hasFeature(p.default.BOT),o>r?1:o<r?-1:(o=i.hasFeature(p.default.BROADCASTER)||i.hasFeature(p.default.BROADCASTER),r=s.hasFeature(p.default.BROADCASTER)||s.hasFeature(p.default.BROADCASTER),o>r?-1:o<r?1:(o=i.hasFeature(p.default.SUBSCRIBER)||i.hasFeature(p.default.SUBSCRIBER),r=s.hasFeature(p.default.SUBSCRIBER)||s.hasFeature(p.default.SUBSCRIBER),o>r?-1:o<r?1:i.nick<s.nick?-1:i.nick>s.nick?1:0))))}).forEach(function(e){return e.parentNode.appendChild(e)})}}]),n}(y),D=function(e){function t(e,n,i){o(this,t);var u=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return u.temotes=u.ui.find("#twitch-emotes"),u.demotes=u.ui.find("#destiny-emotes"),u.demotes.append([].concat(s(u.chat.emoticons)).map(a).join("")),u.temotes.append([].concat(s(u.chat.twitchemotes)).map(a).join("")),u.ui.on("click",".chat-emote",function(e){y.closeMenus(i),u.selectEmote(e.currentTarget.innerText)}),u}return u(t,e),d(t,[{key:"show",value:function(){this.visible||this.chat.input.focus(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"selectEmote",value:function(e){var t=this.chat.input.val().toString().trim();this.chat.input.val(t+(""===t?"":" ")+e+" ").focus()}}]),t}(y),L=function(t){function n(t,i,s){o(this,n);var u=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,s));return u.unread=0,u.empty=e('<span class="empty">No new whispers :(</span>'),u.notif=e('<span id="chat-whisper-notif"></span>'),u.btn.append(u.notif),u.usersEl=t.find("ul:first"),u.usersEl.on("click",".user",function(e){return u.selectConversation(e.target.getAttribute("data-username"))}),u.usersEl.on("click",".remove",function(e){return u.removeConversation(e.target.getAttribute("data-username"))}),u}return u(n,t),d(n,[{key:"removeConversation",value:function(e){var t=e.toLowerCase();this.chat.whispers.delete(t),this.chat.removeWindow(t),this.redraw()}},{key:"selectConversation",value:function(t){var n=this;y.closeMenus(this.chat);var i=t.toLowerCase(),s=this.chat.whispers.get(i);if(s){s.unread=0;var o=this.chat.users.get(i)||new g.default({nick:t}),r=this.chat.getWindow(i);r?this.chat.windowToFront(r.name):(r=new T.default(t,"chat-output-whisper",o.nick).into(this.chat),this.chat.windowToFront(r.name),R.MessageBuilder.info("Messages between you and "+o.nick+"\rEnter /close to exit this conversation, click the round icons below and center of the chat input to toggle between them\ror close them from the whispers menu.\rLoading messages ...").into(this.chat,r),e.ajax({url:"/api/messages/"+encodeURIComponent(o.nick)+"/unread"}).done(function(e){if(0===e.length)R.MessageBuilder.info("No messages returned.").into(n.chat,r);else{var t=(0,w.default)(e[0].timestamp).format("MMMM Do YYYY, h:mm:ss a");R.MessageBuilder.info("Last message "+t).into(n.chat,r),e.reverse().forEach(function(e){var t=n.chat.users.get(e.from.toLowerCase())||new g.default({nick:e.from});R.MessageBuilder.historical(e.message,t,e.timestamp).into(n.chat,r)})}s.loaded=!0}).fail(function(){return R.MessageBuilder.error("Failed to load whispers :(").into(n.chat,r)})),this.chat.input.focus(),this.redraw()}}},{key:"updateNotification",value:function(){var e=this,t=this.unread;this.unread=[].concat(s(this.chat.whispers.entries())).map(function(e){return parseInt(e[1].unread)}).reduce(function(e,t){return e+t},0),t<this.unread&&(this.btn.addClass("ping"),setTimeout(function(){return e.btn.removeClass("ping")},2e3)),this.notif.text(this.unread),this.notif.toggle(this.unread>0);try{var n=window.parent.document.title.replace(/^\([0-9]+\) /,"");window.parent.document.title=this.unread>0?"("+this.unread+") "+n:""+n}catch(e){console.error(e)}}},{key:"redraw",value:function(){var e=this;this.updateNotification(),this.visible&&(this.usersEl.empty(),0===this.chat.whispers.size?this.usersEl.append(this.empty):[].concat(s(this.chat.whispers.entries())).sort(function(e,t){return 0===e[1].unread?1:0===t[1].unread?-1:e[1]===t[1]?0:void 0}).forEach(function(t){return e.addConversation(t[0],t[1].unread)})),h(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"redraw",this).call(this)}},{key:"addConversation",value:function(e,t){var n=this.chat.users.get(e.toLowerCase())||new g.default({nick:e});this.usersEl.append('\n            <li class="conversation unread-'+t+'">\n                <a data-username="'+n.nick.toLowerCase()+'" title="Hide" class="fa fa-times remove"></a>\n                <a data-username="'+n.nick.toLowerCase()+'" class="user">'+n.nick+' <span class="badge">'+t+"</span></a>\n            </li>\n        ")}}]),n}(y);t.ChatMenu=y,t.ChatSettingsMenu=M,t.ChatUserMenu=F,t.ChatEmoteMenu=D,t.ChatWhisperUsers=L}).call(t,n(3))},94:function(e,t,n){"use strict";function i(e,t,n){if(t<=0){var i=o.default.read("chatoptions");i&&Object.keys(i).forEach(function(t){switch(t){case"highlightnicks":e.settings.set("highlightnicks",Object.keys(i[t]));break;default:e.settings.set(t,i[t])}}),i=o.default.read("chatignorelist"),i&&e.settings.set("ignorenicks",Object.keys(i)||[]),i=o.default.read("chat.ignoring"),i&&e.settings.set("ignorenicks",i),i=o.default.read("inputhistory"),i&&o.default.write("chat.history",i),i=e.settings.get("allowNotifications"),void 0!==i&&null!==i&&(e.settings.set("notificationwhisper",i),e.settings.set("notificationhighlight",i),e.settings.delete("allowNotifications")),i=e.settings.get("notificationtimeout"),e.settings.set("notificationtimeout",-1!==i),i=null,o.default.remove("chatoptions"),o.default.remove("inputhistory"),o.default.remove("chatignorelist"),o.default.remove("hiddenhints"),o.default.remove("lasthinttime"),o.default.remove("unreadMessageCount"),o.default.remove("chat.shownhints"),o.default.remove("chat.ignoring"),e.saveSettings()}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(44),o=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default={upgrade:i}},95:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(43),a=function(e){return e&&e.__esModule?e:{default:e}}(u),l=window.WebSocket||window.MozWebSocket,c=function(e){function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sock=null,e}return o(t,e),r(t,[{key:"connect",value:function(e){var t=this;try{null!==this.sock&&(this.disconnect(),this.sock.onopen=null,this.sock.onclose=null,this.sock.onerror=null,this.sock.onmessage=null,this.sock=null),this.emit("CONNECTING"),this.sock=new l(e),this.sock.onopen=function(e){return t.emit("OPEN",e)},this.sock.onclose=function(e){return t.emit("CLOSE",e)},this.sock.onerror=function(e){return t.emit("ERR","socketerror")},this.sock.onmessage=function(e){return t.parseAndDispatch(e)}}catch(e){return console.error(e),this.emit("ERR","unknown")}}},{key:"connected",value:function(){return this.sock&&this.sock.readyState===this.sock.OPEN}},{key:"disconnect",value:function(){this.sock&&this.sock.readyState!==this.sock.CLOSED&&this.sock.close()}},{key:"parseAndDispatch",value:function(e){var t=e.data.split(" ",1)[0].toUpperCase(),n=e.data.substring(t.length+1),i=null;try{i=JSON.parse(n)}catch(e){i=n}this.emit("DISPATCH",{data:i,event:t}),this.emit(t,i)}},{key:"send",value:function(e,t){var n="string"==typeof t?t:JSON.stringify(t);this.connected()?this.sock.send(e+" "+n):this.emit("ERR","notconnected")}}]),t}(a.default);t.default=c}},[314]);