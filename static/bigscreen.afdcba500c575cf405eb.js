(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{128:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i);!function(){var t={height:500,width:420,scrollbars:0,toolbar:0,location:0,status:"no",menubar:0,resizable:0,dependent:0},e=a()("body#bigscreen"),n=e.find("#chat-panel"),i=e.find("#bigscreen-layout"),o=e.find("#chat-panel-resize-bar"),c=e.find("#chat-panel-tools"),r=e.find("#chat-wrap iframe"),l=a()('<div class="overlay"></div>'),s={getOrientation:function(){return localStorage.getItem("bigscreen.chat.orientation")||"0"},setOrientation:function(t){localStorage.setItem("bigscreen.chat.orientation",t)},getSize:function(){return parseFloat(localStorage.getItem("bigscreen.chat.size")||20)},setSize:function(t){var e="0"===this.getOrientation()?100-t:t;localStorage.setItem("bigscreen.chat.size",Math.min(76.6666,Math.max(0,e)).toFixed(4))},applyOrientation:function(){var t=s.getOrientation();switch(i.attr("data-orientation",t),parseInt(t)){case 0:i.removeClass("chat-left").addClass("chat-right");break;case 1:i.removeClass("chat-right").addClass("chat-left")}},applySize:function(){var t=s.getSize(),e=300/i.outerWidth()*100;t>e?n.css("width",Math.max(e,t)+"%"):n.css("width","inherit")}};r.on("load",function(){var i=this.contentWindow;i&&c.on("click touch","#popout",function(){var i;return window.open("/embed/chat","_blank",(i=i?Object.assign({},t,i):t,Object.keys(i).map(function(t){return"".concat(t,"=").concat(i[t])}).join(","))),e.addClass("nochat"),n.remove(),!1}).on("click touch","#refresh",function(){return i.location.reload(),!1}).on("click touch","#close",function(){return e.addClass("nochat"),n.remove(),!1}).on("click touch","#swap",function(){return s.setOrientation("1"===s.getOrientation()?"0":"1"),s.applyOrientation(),!1})}),o.on("mousedown.chat touchstart.chat",function(t){var n=t.clientX||t.originalEvent.touches[0].clientX||0,a=o.position().left,c=i.outerWidth();o.addClass("active");var r=-1;return e.on("mouseup.chat touchend.chat",function(){return-1!==r&&(e.unbind("mousemove.chat mouseup.chat touchend.chat touchmove.chat"),s.setSize(r/c*100),o.removeClass("active").removeAttr("style"),l.remove(),s.applySize(),!1)}).on("mousemove.chat touchmove.chat",function(t){r=t.clientX||t.originalEvent.touches[0].clientX||0,o.css("left",a+(r-n))}).append(l),!1}),s.applyOrientation(),s.applySize();var h=document.location.href,u=e.find("#stream-panel iframe"),d=/^#(twitch|youtube)\/([A-z0-9_-]{3,24})$/,m={live:!1,host:null,preview:null},f={embed:!1,platform:"twitch",title:"Bigscreen",name:"destiny",id:null,url:"/bigscreen"},p=Object.assign({},f),v=["embedded","hidden","hosting","online","offline"],w={container:e.find("#nav-host-pill")},g='<i class="fab fa-fw fa-twitch"></i>';w.left=w.container.find("#nav-host-pill-type"),w.right=w.container.find("#nav-host-pill-name"),w.icon=w.container.find("#nav-host-pill-icon");var b=function(){var t="";if("twitch"===f.platform?t="https://player.twitch.tv/?channel="+encodeURIComponent(f.name):"youtube"===f.platform&&(t="https://www.youtube.com/embed/"+encodeURIComponent(f.name)),""!==t&&u.attr("src")!==t){document.title=f.title+" - Destiny.gg";var e=u.clone();e.attr("src",t),u.replaceWith(e),u=e}},y=function(){w.container.removeClass(v.join(" ")),f.embed?(w.container.addClass("embedded"),w.left.text("EMBED"),w.right.text(f.title),w.icon.html('<i class="fas fa-fw fa-times-circle"></i>')):m.host&&!m.live?(w.container.addClass("hosting"),w.left.text("HOSTING"),w.right.text(m.host.name),w.icon.html(g)):(w.left.text(m.live?"LIVE":"OFFLINE"),w.right.text("Destiny"),w.icon.html(g)),w.container.toggleClass("online",m.live).toggleClass("offline",!!m.live)},O=function(){return a.a.ajax({url:"/api/info/stream"}).then(function(t){var e=t.live,n=t.host,i=t.preview;return Object.assign(m,{live:e,host:n,preview:i})}).then(y)},C=function(){var t=function(t){var e=t||window.location.hash||"";if(e.length>0&&d.test(e)){var n=e.match(d);return{platform:n[1],name:n[2],id:null}}return null}(window.location.hash);t&&(f.embed=!0,f.platform=t.platform,f.title=t.name,f.name=t.name,f.id=t.id)};C(),b(),window.history.replaceState(f,null,h),w.container.on("click touch",function(){return!f.embed&&m.host?(f.embed=!0,f.platform="twitch",f.title=m.host.display_name,f.name=m.host.name,f.id=m.host.id,window.history.pushState(f,null,"#twitch/".concat(f.name))):f.embed&&(f.embed=!1,f.platform=p.platform,f.title=p.title,f.name=p.name,f.id=p.id,Object.assign(f,p),window.history.pushState(f,null,"/bigscreen")),y(),b(),!1}),window.addEventListener("popstate",function(){var t=window.history.state;null==t?C():Object.assign(f,t),y(),b()}),O().always(function(){return window.setInterval(O,15e3)})}()}},[[128,1,0]]]);